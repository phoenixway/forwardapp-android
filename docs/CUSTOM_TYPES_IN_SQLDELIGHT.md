# –ü–æ—Å—ñ–±–Ω–∏–∫: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö —Ç–∏–ø—ñ–≤ (`AS`) –≤ SQLDelight 2.x

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ—è—Å–Ω—é—î, —è–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ SQLDelight –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –≤–∞—à–∏–º–∏ –≤–ª–∞—Å–Ω–∏–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–∏—Ö (–¥–æ–º–µ–Ω–Ω–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏, —Å–ø–∏—Å–∫–∞–º–∏, enum-–∫–ª–∞—Å–∞–º–∏), –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ —ó—Ö —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö —è–∫ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω—ñ —Ç–∏–ø–∏ (`TEXT`, `INTEGER`, `REAL`).

## üéØ –ú–µ—Ç–∞

–ú–∏ —Ö–æ—á–µ–º–æ, —â–æ–± –Ω–∞—à Kotlin-–∫–æ–¥ –ø—Ä–∞—Ü—é–≤–∞–≤ –∑ –±–∞–≥–∞—Ç–∏–º–∏ –¥–æ–º–µ–Ω–Ω–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏, –∞ –Ω–µ –∑ –ø—Ä–∏–º—ñ—Ç–∏–≤–∞–º–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

- **–ü—Ä–∏–∫–ª–∞–¥ 1**: –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ `List<RelatedLink>` —è–∫ `TEXT` (—É —Ñ–æ—Ä–º–∞—Ç—ñ JSON).
- **–ü—Ä–∏–∫–ª–∞–¥ 2**: –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ `Boolean` —è–∫ `INTEGER` (1 –∞–±–æ 0).
- **–ü—Ä–∏–∫–ª–∞–¥ 3**: –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ `enum class DayStatus` —è–∫ `TEXT`.

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º

–î–ª—è —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–≤'—è–∑–∫–∞ –∑ –¥–≤–æ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤:
1.  **–î–µ–∫–ª–∞—Ä–∞—Ü—ñ—è `AS` —É `.sq` —Ñ–∞–π–ª—ñ**: –í–∫–∞–∑—É—î –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—É –∫–æ–¥—É, —è–∫–∏–π Kotlin-—Ç–∏–ø –º–∏ *—Ö–æ—á–µ–º–æ* –±–∞—á–∏—Ç–∏ —É –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö –∫–ª–∞—Å–∞—Ö.
2.  **`ColumnAdapter` —É Kotlin**: –ù–∞–¥–∞—î –ª–æ–≥—ñ–∫—É –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—ñ–∂ –¥–æ–º–µ–Ω–Ω–∏–º —Ç–∏–ø–æ–º —Ç–∞ —Ç–∏–ø–æ–º –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

---

## üìù –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ `Goal`.

### –ö—Ä–æ–∫ 1: –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è `.sq` —Ñ–∞–π–ª—É

–£ –≤–∞—à–æ–º—É `.sq` —Ñ–∞–π–ª—ñ (–Ω–∞–ø—Ä., `Goal.sq`) –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑–∞—Ç–∏, —è–∫–∏–π Kotlin-—Ç–∏–ø –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∫–æ–ª–æ–Ω—Ü—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

1.  **–î–æ–¥–∞–π—Ç–µ —ñ–º–ø–æ—Ä—Ç–∏** –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ñ–∞–π–ª—É –¥–ª—è –≤—Å—ñ—Ö –∫–∞—Å—Ç–æ–º–Ω–∏—Ö —Ç–∏–ø—ñ–≤. –¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ, —â–æ–± –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–Ω–∞–≤ –ø–æ–≤–Ω—ñ —à–ª—è—Ö–∏ –¥–æ –∫–ª–∞—Å—ñ–≤.

    ```sql
    -- Goal.sq
    import kotlin.Boolean;
    import kotlin.collections.List;
    import com.romankozak.forwardappmobile.shared.data.database.models.RelatedLink;
    ```

2.  **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `AS`** —É –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—ó —Ç–∞–±–ª–∏—Ü—ñ `CREATE TABLE`.

    ```sql
    -- Goal.sq
    CREATE TABLE Goals (
        -- ...
        completed INTEGER AS kotlin.Boolean NOT NULL DEFAULT 0,
        relatedLinks TEXT AS List<RelatedLink>,
        -- ...
    );
    ```
    - `completed INTEGER AS kotlin.Boolean` ‚Äî –≤–∫–∞–∑—É—î, —â–æ –∫–æ–ª–æ–Ω–∫–∞ `completed` —Ç–∏–ø—É `INTEGER` —É Kotlin-–∫–æ–¥—ñ –º–∞—î –±—É—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —è–∫ `Boolean`.
    - `relatedLinks TEXT AS List<RelatedLink>` ‚Äî –≤–∫–∞–∑—É—î, —â–æ –∫–æ–ª–æ–Ω–∫–∞ `relatedLinks` —Ç–∏–ø—É `TEXT` —É Kotlin-–∫–æ–¥—ñ –º–∞—î –±—É—Ç–∏ `List<RelatedLink>`.

### –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è `ColumnAdapter`

–£ Kotlin-–∫–æ–¥—ñ (`shared/commonMain`) —Å—Ç–≤–æ—Ä—ñ—Ç—å –∞–¥–∞–ø—Ç–µ—Ä–∏, —è–∫—ñ –±—É–¥—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è.

- **–î–ª—è `List<RelatedLink>` -> `String` (JSON)**:

  ```kotlin
  // DatabaseDriverFactory.kt
  val relatedLinksListAdapter = object : ColumnAdapter<List<RelatedLink>, String> {
      override fun decode(databaseValue: String): List<RelatedLink> {
          // –Ø–∫—â–æ —Ä—è–¥–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫
          if (databaseValue.isEmpty()) return emptyList()
          return Json.decodeFromString(ListSerializer(RelatedLink.serializer()), databaseValue)
      }

      override fun encode(value: List<RelatedLink>): String {
          return Json.encodeToString(ListSerializer(RelatedLink.serializer()), value)
      }
  }
  ```

- **–î–ª—è `Boolean` -> `Long`**:
  SQLDelight –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω–∏–π –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è `Boolean`, —Ç–æ–º—É –¥–ª—è –Ω—å–æ–≥–æ **–Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Å–≤—ñ–π `ColumnAdapter`**. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–¥—É —Å–∞–º –≤–ø–æ—Ä–∞—î—Ç—å—Å—è.

### –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `DatabaseDriverFactory`

–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ `AS` —É `.sq` —Ñ–∞–π–ª—ñ, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `ForwardAppDatabase` –±—É–¥–µ –≤–∏–º–∞–≥–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∞–¥–∞–ø—Ç–µ—Ä–∏.

1.  **–ó–Ω–∞–π–¥—ñ—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–ª–∞—Å `Adapter`**: –ó–∞–≥–ª—è–Ω—å—Ç–µ —É –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ñ–∞–π–ª `shared/build/generated/sqldelight/code/ForwardAppDatabase/commonMain/.../Goals.kt`. –£ –Ω—å–æ–º—É –±—É–¥–µ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –∫–ª–∞—Å `Adapter`, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —è–∫–æ–≥–æ –ø–æ–∫–∞–∂–µ, —è–∫—ñ —Å–∞–º–µ –∞–¥–∞–ø—Ç–µ—Ä–∏ –æ—á—ñ–∫—É—î SQLDelight.

    ```kotlin
    // –ü—Ä–∏–∫–ª–∞–¥ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–≥–æ Goals.kt
    public data class Goals(
      // ...
    ) {
      public class Adapter(
        // SQLDelight –Ω–µ –≤–∏–º–∞–≥–∞—î –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è Boolean, –±–æ –≤—ñ–Ω –≤–±—É–¥–æ–≤–∞–Ω–∏–π.
        public val relatedLinksAdapter: ColumnAdapter<List<RelatedLink>, String>
      )
    }
    ```

2.  **–ü–µ—Ä–µ–¥–∞–π—Ç–µ –∞–¥–∞–ø—Ç–µ—Ä–∏** –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –µ–∫–∑–µ–º–ø–ª—è—Ä—É `ForwardAppDatabase`.

    ```kotlin
    // DatabaseDriverFactory.kt
    fun createForwardAppDatabase(
        driverFactory: DatabaseDriverFactory,
    ): ForwardAppDatabase {
        return ForwardAppDatabase(
            driver = driverFactory.createDriver(),
            // ... —ñ–Ω—à—ñ –∞–¥–∞–ø—Ç–µ—Ä–∏ –¥–ª—è DayPlans, DayTasks ...
            GoalsAdapter = Goals.Adapter(
                // booleanAdapter –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ!
                relatedLinksAdapter = relatedLinksListAdapter
            )
        )
    }
    ```

### –ö—Ä–æ–∫ 4: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–¥—É

–ü—ñ—Å–ª—è –±—É–¥—å-—è–∫–∏—Ö –∑–º—ñ–Ω —É `.sq` —Ñ–∞–π–ª–∞—Ö –∞–±–æ —Ñ–∞–±—Ä–∏—Ü—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, **–∑–∞–≤–∂–¥–∏** –≤–∏–∫–æ–Ω—É–π—Ç–µ –ø–æ–≤–Ω—É –æ—á–∏—Å—Ç–∫—É —Ç–∞ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—é.

```bash
./gradlew clean :shared:generateCommonMainForwardAppDatabaseInterface
```

### –ö—Ä–æ–∫ 5: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—è—Ö —Ç–∞ –º–∞–ø–ø–µ—Ä–∞—Ö

–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ SQLDelight —Å–∞–º –∑–∞–π–º–∞—î—Ç—å—Å—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è–º —Ç–∏–ø—ñ–≤, –≤–∞—à –∫–æ–¥ —Å—Ç–∞—î –∑–Ω–∞—á–Ω–æ —á–∏—Å—Ç—ñ—à–∏–º.

- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π (`GoalRepositoryImpl.kt`)**:
  –í–∞–º –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä—É—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è. –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –¥–æ–º–µ–Ω–Ω—ñ –æ–±'—î–∫—Ç–∏ –Ω–∞–ø—Ä—è–º—É.

  ```kotlin
  // –ë–£–õ–û
  queries.insertGoal(
      completed = if (goal.completed) 1L else 0L,
      relatedLinks = goal.relatedLinks?.let { Json.encodeToString(...) }
  )

  // –°–¢–ê–õ–û
  queries.insertGoal(
      completed = goal.completed,
      relatedLinks = goal.relatedLinks
  )
  ```

- **–ú–∞–ø–ø–µ—Ä (`GoalMapper.kt`)**:
  –õ–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–∫–æ–∂ –∑–Ω–∏–∫–∞—î.

  ```kotlin
  // –ë–£–õ–û –≤ toDomain()
  completed = this.completed != 0L,
  relatedLinks = this.relatedLinks?.let { Json.decodeFromString(...) }

  // –°–¢–ê–õ–û –≤ toDomain()
  completed = this.completed,
  relatedLinks = this.relatedLinks
  ```

---

## üöë –ü–æ—à—É–∫ —Ç–∞ —É—Å—É–Ω–µ–Ω–Ω—è –Ω–µ—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

- **–ü–æ–º–∏–ª–∫–∞: `No parameter with name '...Adapter' found`**
  - **–ü—Ä–∏—á–∏–Ω–∞**: –í–∏ –Ω–∞–º–∞–≥–∞—î—Ç–µ—Å—è –ø–µ—Ä–µ–¥–∞—Ç–∏ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `...Adapter` –ø–∞—Ä–∞–º–µ—Ç—Ä, —è–∫–æ–≥–æ –≤—ñ–Ω –Ω–µ –æ—á—ñ–∫—É—î (–Ω–∞–ø—Ä., `completedAdapter`).
  - **–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–ª–∞—Å `Adapter` —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–º—É —Ñ–∞–π–ª—ñ `build/generated/.../TableName.kt` —ñ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ª–∏—à–µ —Ç—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, —â–æ –≤–∫–∞–∑–∞–Ω—ñ –≤ –π–æ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ.

- **–ü–æ–º–∏–ª–∫–∞: `Unresolved reference: <CustomType>` —É –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–º—É –∫–æ–¥—ñ**
  - **–ü—Ä–∏—á–∏–Ω–∞**: –í–∏ –∑–∞–±—É–ª–∏ –¥–æ–¥–∞—Ç–∏ `import com.package.MyType;` –Ω–∞ –ø–æ—á–∞—Ç–∫—É `.sq` —Ñ–∞–π–ª—É.
  - **–†—ñ—à–µ–Ω–Ω—è**: –î–æ–¥–∞–π—Ç–µ –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —ñ–º–ø–æ—Ä—Ç–∏ –¥–ª—è –≤–∞—à–∏—Ö –∫–∞—Å—Ç–æ–º–Ω–∏—Ö —Ç–∏–ø—ñ–≤.

- **–ü–æ–º–∏–ª–∫–∞: `Expecting 1 parameter but found 0` –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É `ForwardAppDatabase(...)`**
  - **–ü—Ä–∏—á–∏–Ω–∞**: –í–∏ –¥–æ–¥–∞–ª–∏ `AS` —É `.sq` —Ñ–∞–π–ª, –∞–ª–µ –∑–∞–±—É–ª–∏ –æ–Ω–æ–≤–∏—Ç–∏ `DatabaseDriverFactory.kt` —ñ –ø–µ—Ä–µ–¥–∞—Ç–∏ —Ç—É–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π `...Adapter`.
  - **–†—ñ—à–µ–Ω–Ω—è**: –í–∏–∫–æ–Ω–∞–π—Ç–µ –ö—Ä–æ–∫ 3.

- **–ó–∞–≥–∞–ª—å–Ω–∞ –ø–æ—Ä–∞–¥–∞**: –Ø–∫—â–æ —â–æ—Å—å –Ω–µ –ø—Ä–∞—Ü—é—î, –ø–µ—Ä—à–∏–º –¥—ñ–ª–æ–º –≤–∏–∫–æ–Ω–∞–π—Ç–µ `./gradlew clean ...` (–ö—Ä–æ–∫ 4). –î—É–∂–µ —á–∞—Å—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª—è–≥–∞—î —É –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö.
