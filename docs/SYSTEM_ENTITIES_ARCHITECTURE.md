# Архітектура системних сутностей та вкладень

Цей документ описує концепцію "спеціальних проектів" та "вкладень", які є основою для організації даних у додатку.

## 1. Концепція "Спеціальних проектів"

"Спеціальні проекти" — це записи в таблиці `projects`, які мають особливий статус і поведінку. Вони не створюються користувачем напряму, а ініціалізуються системою для реалізації ключової методології додатку (наприклад, керування задачами на день, тиждень, стратегічне планування).

### Властивості, що їх визначають:

-   `systemKey: String?`: Унікальний текстовий ключ, який ідентифікує проект для системи (напр., `inbox`, `today`, `strategic`). Визначені в `ReservedProjectKeys.kt`.
-   `projectType: ProjectType`: `Enum` зі значеннями:
    -   `SYSTEM`: Базові, кореневі проекти-контейнери (напр., `personal-management`).
    -   `RESERVED`: Функціональні проекти, що є частиною методології (напр., `today`, `week`).
    -   `DEFAULT`: Звичайні проекти, створені користувачем.
-   `reservedGroup: ReservedGroup?`: `Sealed class`, що групує спеціальні проекти за логікою (напр., `Inbox`, `Strategic`). Визначений в `ReservedGroup.kt`.

### Призначення:

Ці проекти слугують як заздалегідь визначені "контейнери" для організації цілей, нотаток та інших сутностей. Наприклад, проект `today` призначений для агрегації всього, що користувач планує на день. Система може автоматично додавати або переміщувати елементи в ці проекти.

## 2. Концепція "Вкладень"

"Вкладення" (Attachment) — це не окрема таблиця в базі даних, а **загальна концепція** для будь-яких сутностей, які можуть бути прикріплені до проекту.

### Як це працює:

-   **Зв'язуюча сутність `ListItem`**: Зв'язок між проектом та його вмістом реалізується через таблицю `list_items`. Кожен запис у цій таблиці є "вказівником".
-   **Поля `ListItem`**:
    -   `projectId`: ID проекту-контейнера.
    -   `entityId`: ID сутності, яка є "вкладеною" (напр., ID нотатки, цілі, чекліста).
    -   `itemType`: Текстове поле, що визначає тип вкладеної сутності (напр., `NOTE_DOCUMENT`, `CHECKLIST`, `GOAL`). Усі можливі типи визначені в `ListItemTypeValues`.

Таким чином, будь-який об'єкт (нотатка, чекліст, посилання) може стати "вкладенням" у будь-який проект, просто створивши відповідний запис у таблиці `list_items`.

`Goal` (ціль) та `SUBLIST` (підпроект) технічно є такими ж "вкладеннями", але в UI зазвичай трактуються як основний контент, а не як допоміжні матеріали.

## 3. Попередня ініціалізація

Спеціальні проекти та системні додатки створюються автоматично при першому запуску додатку або після повного очищення даних.

-   **Клас `DatabaseInitializer`**: Відповідає за цей процес.
-   **Метод `prePopulate()`**: Викликається при старті бази даних.
-   **Метод `ensureProjectExists()`**: Перевіряє наявність спеціального проекту за його `systemKey`. Якщо проект відсутній, створює новий запис у таблиці `projects` з усіма необхідними властивостями (`projectType`, `reservedGroup` тощо).

Це гарантує, що ключові для роботи додатку проекти, як-от "Inbox" та "Today", завжди присутні в системі.

## 4. Ключові файли

-   **Моделі**: `data/database/models/DatabaseModel.kt` (визначення `Project`, `ListItem`), `ReservedGroup.kt`, `ReservedProjectKeys.kt`.
-   **Ініціалізація**: `data/database/DatabaseInitializer.kt`.
-   **Бізнес-логіка**: `data/repository/ProjectRepository.kt` (формує контент проекту для UI), `data/repository/AttachmentRepository.kt` (абстракція для керування вкладеннями), `data/dao/ProjectDao.kt`, `data/dao/ListItemDao.kt`.
