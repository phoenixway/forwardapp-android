## 1. Поточне завдання (CURRENT TASK)
- **Вирішено:** Проблема з автосинхронізацією, коли видалені цілі "оживали" на стороні Android. Проте, цілі все ще зберігаються на десктопі.

## 3. План дій
- [x] Додано логування в процес видалення "цілі" (`GoalRepository.deleteGoal`).
- [x] Додано розширене логування в логіку об'єднання даних при синхронізації (`SyncRepository.applyServerChanges`).
- [x] Проаналізовано логи та виявлено, що "воскресіння" відбувається через те, що десктопний клієнт надсилає "живий" запис із вищою версією, ніж локальний "tombstone".
- [x] **Виправлено (спроба 1):** Додано фільтр `is_deleted = 0` до запитів у `GoalDao.kt`. (Виявилося некоректним, бо ламало логіку синхронізації).
- [x] **Виправлено (спроба 2):** Створено окремі методи в DAO для UI, що фільтрують видалені записи, і повернуто `getAll` для логіки синхронізації.
- [x] **Виправлено (фінальна версія):** Посилено логіку захисту "tombstone" у `SyncRepository.mergeAndMark`. Видалено перевірку за часом (`locUpdated >= incUpdated`), щоб локально видалений запис **завжди** мав пріоритет над "живим" записом, що надходить ззовні. Це запобігає "воскресінню" на Android.
- [x] Проблема "воскресіння" на Android вирішена.
- [ ] Написати тест для запобігання регресії.

## 4. Невирішені проблеми / Блокери (PROBLEMS)
- Ціль, видалена на Android, все ще зберігається на десктопній версії після синхронізації. Це проблема логіки синхронізації десктопного клієнта, який не коректно обробляє "tombstone" записи, отримані від Android.

## 5. Значимі файли і модулі (IMPORTANT FILES / MODULES)
- `data/repository/SyncRepository.kt` - місце фінального виправлення.
- `data/dao/GoalDao.kt` - виправлено запити до БД.

## 6. Інструкції та вимоги до стилю (INSTRUCTIONS)

- Не переписувати архітектуру без підтвердження  
- Виконувати лише один крок за раз  
- Не змінювати DI без дозволу  
- Додавати пропозицію оновлення контексту після кожної дії  
- Писати код, що точно компілюється  
- Завжди пояснювати причину помилки  

---

## 7. Замітки для агента (NOTES)
- ідеї в SYNAPSE_DESIGN.md, SYNC_FEATURE_SPEC.md
---

## 8. Після цього
- Можна прибрати додане логування з `GoalRepository` та `SyncRepository`.
- Можна додати TDD тест, що перевіряє цей випадок.
---