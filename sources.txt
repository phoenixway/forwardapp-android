TABLE OF CONTENTS
================================================================================

- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/dao/RecentItemDao.kt](##<<FILE_1>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/database/models/RecentItem.kt](##<<FILE_2>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/repository/RecentItemsRepository.kt](##<<FILE_3>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/routes/AppNavigation.kt](##<<FILE_4>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/components/NewRecentListsSheet.kt](##<<FILE_5>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/navigation/NavigationDispatcher.kt](##<<FILE_6>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentUiEvent.kt](##<<FILE_7>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentViewModel.kt](##<<FILE_8>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/screens/commanddeck/SharedCommandDeckLayout.kt](##<<FILE_9>>)
- [/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/screens/commanddeck/components/DashboardBottomBar.kt](##<<FILE_10>>)

================================================================================

## <<FILE_1>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/dao/RecentItemDao.kt (ID: FILE_1)
================================================================================

package com.romankozak.forwardappmobile.data.dao

import androidx.room.Dao
import androidx.room.Insert
import androidx.room.OnConflictStrategy
import androidx.room.Query
import com.romankozak.forwardappmobile.data.database.models.RecentItem
import kotlinx.coroutines.flow.Flow

@Dao
interface RecentItemDao {

    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun logAccess(item: RecentItem)

    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insertAll(items: List<RecentItem>)

    @Query("SELECT * FROM recent_items ORDER BY lastAccessed DESC LIMIT :limit")
    fun getRecentItems(limit: Int): Flow<List<RecentItem>>

    @Query("SELECT * FROM recent_items WHERE id = :id")
    suspend fun getRecentItemById(id: String): RecentItem?


    @Query("SELECT * FROM recent_items")
    fun getAll(): List<RecentItem>

    @Query("DELETE FROM recent_items")
    suspend fun deleteAll()
}


================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/dao/RecentItemDao.kt
================================================================================

## <<FILE_2>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/database/models/RecentItem.kt (ID: FILE_2)
================================================================================

package com.romankozak.forwardappmobile.data.database.models

import androidx.room.Entity
import androidx.room.PrimaryKey

enum class RecentItemType {
    PROJECT,
    NOTE,
    NOTE_DOCUMENT,
    OBSIDIAN_LINK,
    CHECKLIST,
}

@Entity(tableName = "recent_items")
data class RecentItem(
    @PrimaryKey
    val id: String,
    val type: RecentItemType,
    val lastAccessed: Long,
    val displayName: String,
    val target: String, // Project ID, Legacy Note ID, Note ID, or Obsidian URI
    val isPinned: Boolean = false
)


================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/database/models/RecentItem.kt
================================================================================

## <<FILE_3>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/repository/RecentItemsRepository.kt (ID: FILE_3)
================================================================================

package com.romankozak.forwardappmobile.data.repository

import android.util.Log
import com.romankozak.forwardappmobile.data.dao.RecentItemDao
import com.romankozak.forwardappmobile.data.database.models.LegacyNoteEntity
import com.romankozak.forwardappmobile.data.database.models.NoteDocumentEntity
import com.romankozak.forwardappmobile.data.database.models.Project
import com.romankozak.forwardappmobile.data.database.models.RecentItem
import com.romankozak.forwardappmobile.data.database.models.RecentItemType
import com.romankozak.forwardappmobile.data.database.models.RelatedLink
import com.romankozak.forwardappmobile.data.database.models.ChecklistEntity
import kotlinx.coroutines.flow.Flow
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class RecentItemsRepository @Inject constructor(
    private val recentItemDao: RecentItemDao
) {
    fun getRecentItems(limit: Int = 20): Flow<List<RecentItem>> = recentItemDao.getRecentItems(limit)

    suspend fun logProjectAccess(project: Project) {
        val existingItem = recentItemDao.getRecentItemById(project.id)
        val recentItem = if (existingItem != null) {
            existingItem.copy(lastAccessed = System.currentTimeMillis())
        } else {
            RecentItem(
                id = project.id,
                type = RecentItemType.PROJECT,
                lastAccessed = System.currentTimeMillis(),
                displayName = project.name,
                target = project.id
            )
        }
        Log.d("Recents_Debug", "Logging project access: $recentItem")
        recentItemDao.logAccess(recentItem)
    }

    suspend fun logNoteAccess(note: LegacyNoteEntity) {
        val existingItem = recentItemDao.getRecentItemById(note.id)
        val recentItem = if (existingItem != null) {
            existingItem.copy(lastAccessed = System.currentTimeMillis())
        } else {
            RecentItem(
                id = note.id,
                type = RecentItemType.NOTE,
                lastAccessed = System.currentTimeMillis(),
                displayName = note.title,
                target = note.id
            )
        }
        Log.d("Recents_Debug", "Logging note access: $recentItem")
        recentItemDao.logAccess(recentItem)
    }

    suspend fun logNoteDocumentAccess(document: NoteDocumentEntity) {
        val existingItem = recentItemDao.getRecentItemById(document.id)
        val recentItem = if (existingItem != null) {
            existingItem.copy(lastAccessed = System.currentTimeMillis())
        } else {
            RecentItem(
                id = document.id,
                type = RecentItemType.NOTE_DOCUMENT,
                lastAccessed = System.currentTimeMillis(),
                displayName = document.name,
                target = document.id
            )
        }
        Log.d("Recents_Debug", "Logging note document access: $recentItem")
        recentItemDao.logAccess(recentItem)
    }

    suspend fun logChecklistAccess(checklist: ChecklistEntity) {
        val existingItem = recentItemDao.getRecentItemById(checklist.id)
        val recentItem =
            if (existingItem != null) {
                existingItem.copy(lastAccessed = System.currentTimeMillis(), displayName = checklist.name)
            } else {
                RecentItem(
                    id = checklist.id,
                    type = RecentItemType.CHECKLIST,
                    lastAccessed = System.currentTimeMillis(),
                    displayName = checklist.name,
                    target = checklist.id,
                )
            }
        Log.d("Recents_Debug", "Logging checklist access: $recentItem")
        recentItemDao.logAccess(recentItem)
    }

    suspend fun logObsidianLinkAccess(link: RelatedLink) {
        val existingItem = recentItemDao.getRecentItemById(link.target)
        val recentItem = if (existingItem != null) {
            existingItem.copy(lastAccessed = System.currentTimeMillis())
        } else {
            RecentItem(
                id = link.target,
                type = RecentItemType.OBSIDIAN_LINK,
                lastAccessed = System.currentTimeMillis(),
                displayName = link.displayName ?: link.target,
                target = link.target
            )
        }
        Log.d("Recents_Debug", "Logging obsidian link access: $recentItem")
        recentItemDao.logAccess(recentItem)
    }

    suspend fun updateRecentItem(item: RecentItem) {
        recentItemDao.logAccess(item)
    }
    
    suspend fun updateRecentItemDisplayName(itemId: String, displayName: String) {
        val recentItem = recentItemDao.getRecentItemById(itemId)
        if (recentItem != null) {
            recentItemDao.logAccess(recentItem.copy(displayName = displayName))
        }
    }
}


================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/data/repository/RecentItemsRepository.kt
================================================================================

## <<FILE_4>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/routes/AppNavigation.kt (ID: FILE_4)
================================================================================

package com.romankozak.forwardappmobile.routes

import android.util.Log
import androidx.compose.animation.ExperimentalSharedTransitionApi
import androidx.compose.animation.SharedTransitionLayout
import androidx.compose.animation.SharedTransitionScope
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.hilt.navigation.compose.hiltViewModel
import androidx.lifecycle.compose.collectAsStateWithLifecycle
import androidx.navigation.NavGraphBuilder
import androidx.navigation.NavHostController
import androidx.navigation.NavType
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.compose.rememberNavController
import androidx.navigation.navArgument
import androidx.navigation.navigation
import com.romankozak.forwardappmobile.data.database.models.RecentItem
import com.romankozak.forwardappmobile.data.database.models.RecentItemType
import com.romankozak.forwardappmobile.features.attachments.ui.library.AttachmentsLibraryScreen
import com.romankozak.forwardappmobile.features.missions.presentation.TacticalManagementScreen
import com.romankozak.forwardappmobile.ui.navigation.AppNavigationViewModel
import com.romankozak.forwardappmobile.ui.navigation.NavigationCommand
import com.romankozak.forwardappmobile.ui.recent.RecentViewModel
import com.romankozak.forwardappmobile.ui.reminders.list.RemindersScreen
import com.romankozak.forwardappmobile.ui.screens.ManageContextsScreen
import com.romankozak.forwardappmobile.ui.screens.activitytracker.ActivityTrackerScreen
import com.romankozak.forwardappmobile.ui.screens.commanddeck.SharedCommandDeckLayout
import com.romankozak.forwardappmobile.ui.screens.daymanagement.dayplan.EditTaskScreen
import com.romankozak.forwardappmobile.ui.screens.globalsearch.GlobalSearchScreen
import com.romankozak.forwardappmobile.ui.screens.globalsearch.GlobalSearchViewModel
import com.romankozak.forwardappmobile.ui.screens.inbox.InboxEditorScreen
import com.romankozak.forwardappmobile.ui.screens.insights.AiInsightsScreen
import com.romankozak.forwardappmobile.ui.screens.lifestate.LifeStateScreen
import com.romankozak.forwardappmobile.ui.screens.listchooser.FilterableListChooserScreen
import com.romankozak.forwardappmobile.ui.screens.listchooser.FilterableListChooserViewModel
import com.romankozak.forwardappmobile.ui.screens.mainscreen.ProjectHierarchyScreen
import com.romankozak.forwardappmobile.ui.screens.mainscreen.ProjectHierarchyScreenViewModel
import com.romankozak.forwardappmobile.ui.screens.mainscreen.models.ProjectHierarchyScreenEvent
import com.romankozak.forwardappmobile.ui.screens.notedocument.NoteDocumentEditorScreen
import com.romankozak.forwardappmobile.ui.screens.notedocument.NoteDocumentScreen
import com.romankozak.forwardappmobile.ui.screens.projectscreen.BacklogViewModel
import com.romankozak.forwardappmobile.ui.screens.projectscreen.ProjectsScreen
import com.romankozak.forwardappmobile.ui.screens.projectsettings.ProjectSettingsScreen
import com.romankozak.forwardappmobile.ui.screens.script.ScriptChooserScreen
import com.romankozak.forwardappmobile.ui.screens.script.ScriptEditorScreen
import com.romankozak.forwardappmobile.ui.screens.script.ScriptsLibraryScreen
import com.romankozak.forwardappmobile.ui.screens.settings.SettingsScreen
import com.romankozak.forwardappmobile.ui.screens.sync.SyncScreen
import com.romankozak.forwardappmobile.ui.shared.SyncDataViewModel
import java.net.URLDecoder
import kotlinx.coroutines.launch
import com.romankozak.forwardappmobile.ui.navigation.NavTarget


const val MAIN_GRAPH_ROUTE = "main_graph"
const val COMMAND_DECK_ROUTE = "command_deck_screen"
const val GOAL_LISTS_ROUTE = "goal_lists_screen"
const val AI_INSIGHTS_ROUTE = "ai_insights_screen"
const val LIFE_STATE_ROUTE = "life_state_screen"
const val SELECTIVE_IMPORT_ROUTE = "selective_import_screen/{fileUri}"

@OptIn(ExperimentalSharedTransitionApi::class)
@Composable
fun AppNavigation(syncDataViewModel: SyncDataViewModel) {
  val navController = rememberNavController()
  val appNavigationViewModel: AppNavigationViewModel = hiltViewModel()

  val navigationManager = appNavigationViewModel.navigationManager

  LaunchedEffect(navigationManager, navController) {
    navigationManager.navigationCommandFlow.collect { command ->
      when (command) {
        is NavigationCommand.Navigate -> {
          val options = command.builder
          navController.navigate(command.route, options ?: {})
        }

        is NavigationCommand.NavigateTarget -> {
          val route = mapTargetToRoute(command.target)
          val options = command.builder
          navController.navigate(route, options ?: {})
        }

        is NavigationCommand.PopBack -> {
          if (command.key != null && command.value != null) {
            navController.previousBackStackEntry?.savedStateHandle?.set(command.key, command.value)
          }
          navController.popBackStack()
        }
      }
    }
  }

  SharedTransitionLayout {
    NavHost(navController = navController, startDestination = MAIN_GRAPH_ROUTE) {
      navigation(startDestination = COMMAND_DECK_ROUTE, route = MAIN_GRAPH_ROUTE) {
        mainGraph(
          navController,
          syncDataViewModel,
          appNavigationViewModel,
          this@SharedTransitionLayout,
        )
      }
    }
  }
}

@OptIn(ExperimentalSharedTransitionApi::class)
private fun NavGraphBuilder.mainGraph(
  navController: NavHostController,
  syncDataViewModel: SyncDataViewModel,
  appNavigationViewModel: AppNavigationViewModel,
  sharedTransitionScope: SharedTransitionScope,
) {
  composable(COMMAND_DECK_ROUTE) { backStackEntry ->
    val parentEntry = remember(backStackEntry) { navController.getBackStackEntry(MAIN_GRAPH_ROUTE) }
    val viewModel: ProjectHierarchyScreenViewModel = hiltViewModel(parentEntry)
    val scope = rememberCoroutineScope()

    SharedCommandDeckLayout(
      navController = navController,
      onNavigateToProjectHierarchy = { navController.navigate(GOAL_LISTS_ROUTE) },
      onNavigateToGlobalSearch = { navController.navigate("global_search") },
      onNavigateToSettings = { navController.navigate("settings_screen") },
      onNavigateToInbox = {
        scope.launch {
          val inboxId = viewModel.getInboxProjectId()
          if (inboxId != null) {
            navController.navigate("goal_detail_screen/$inboxId?initialViewMode=INBOX")
          }
        }
      },
      onNavigateToTracker = { navController.navigate("activity_tracker_screen") },
      onNavigateToReminders = { navController.navigate("reminders_screen") },
      onNavigateToAiChat = { navController.navigate(AI_INSIGHTS_ROUTE) },
      onNavigateToAiLifeManagement = { navController.navigate(LIFE_STATE_ROUTE) },
      onNavigateToImportExport = {
        navController.navigate(SELECTIVE_IMPORT_ROUTE.replace("/{fileUri}", ""))
      },
      onNavigateToAttachments = { navController.navigate("attachments_library_screen") },
      onNavigateToScripts = { navController.navigate("scripts_library_screen") },
      onNavigateToRecentItem = { item: RecentItem ->
        when (item.type) {
          RecentItemType.PROJECT -> navController.navigate("goal_detail_screen/${item.target}")

          RecentItemType.NOTE,
          RecentItemType.NOTE_DOCUMENT ->
            navController.navigate("note_document_screen/${item.target}")

          RecentItemType.CHECKLIST ->
            navController.navigate("checklist_screen?checklistId=${item.target}")

          RecentItemType.OBSIDIAN_LINK -> {
            // Поки що просто лог або нічого
            Log.d("RecentItemNav", "Obsidian link clicked: ${item.target}")
          }
        }
      },
      recentViewModel = hiltViewModel<RecentViewModel>(),
    )
  }

  composable(GOAL_LISTS_ROUTE) { backStackEntry ->
    val parentEntry = remember(backStackEntry) { navController.getBackStackEntry(MAIN_GRAPH_ROUTE) }
    val viewModel: ProjectHierarchyScreenViewModel = hiltViewModel(parentEntry)

    viewModel.enhancedNavigationManager = appNavigationViewModel.navigationManager

    ProjectHierarchyScreen(
      navController = navController,
      syncDataViewModel = syncDataViewModel,
      viewModel = viewModel,
      sharedTransitionScope = sharedTransitionScope,
      animatedVisibilityScope = this,
    )
  }

  composable(
    route =
      "goal_detail_screen/{listId}?goalId={goalId}&itemIdToHighlight={itemIdToHighlight}&inboxRecordIdToHighlight={inboxRecordIdToHighlight}&initialViewMode={initialViewMode}",
    arguments =
      listOf(
        navArgument("listId") { type = NavType.StringType },
        navArgument("goalId") {
          type = NavType.StringType
          nullable = true
        },
        navArgument("itemIdToHighlight") {
          type = NavType.StringType
          nullable = true
        },
        navArgument("inboxRecordIdToHighlight") {
          type = NavType.StringType
          nullable = true
        },
        navArgument("initialViewMode") {
          type = NavType.StringType
          nullable = true
        },
      ),
  ) { backStackEntry -> // Add backStackEntry here
    val viewModel: BacklogViewModel = hiltViewModel()
    viewModel.enhancedNavigationManager = appNavigationViewModel.navigationManager

    // FIX: Extract the 'listId' argument from the route and assign it to a variable.
    val projectId = backStackEntry.arguments?.getString("listId")

    ProjectsScreen(
      navController = navController,
      viewModel = viewModel,
      projectId = projectId, // Now 'projectId' is a resolved reference.
      sharedTransitionScope = sharedTransitionScope,
      animatedVisibilityScope = this,
    )
  }

  composable(
    "global_search_screen/{query}",
    arguments = listOf(navArgument("query") { type = NavType.StringType }),
  ) {
    val viewModel: GlobalSearchViewModel = hiltViewModel()
    viewModel.enhancedNavigationManager = appNavigationViewModel.navigationManager

    GlobalSearchScreen(viewModel = viewModel, navController = navController)
  }

  composable("attachments_library_screen") {
    AttachmentsLibraryScreen(navController = navController)
  }

  composable("scripts_library_screen") { ScriptsLibraryScreen(navController = navController) }

  composable("script_chooser_screen") { ScriptChooserScreen(navController = navController) }

  composable(LIFE_STATE_ROUTE) { LifeStateScreen(navController = navController) }

  composable("settings_screen") { backStackEntry ->
    val parentEntry = remember(backStackEntry) { navController.getBackStackEntry(MAIN_GRAPH_ROUTE) }
    val goalListViewModel: ProjectHierarchyScreenViewModel = hiltViewModel(parentEntry)

    val uiState by goalListViewModel.uiState.collectAsStateWithLifecycle()
    val reservedContextCount = uiState.allContexts.count { it.isReserved }

    SettingsScreen(
      planningSettings = uiState.planningSettings,
      initialVaultName = uiState.obsidianVaultName,
      reservedContextCount = reservedContextCount,
      onManageContextsClick = { navController.navigate("manage_contexts_screen") },
      onBack = { navController.popBackStack() },
      onSave = { settings ->
        goalListViewModel.onEvent(ProjectHierarchyScreenEvent.SaveSettings(settings))
      },
    )
  }

  composable("manage_contexts_screen") { backStackEntry ->
    val parentEntry = remember(backStackEntry) { navController.getBackStackEntry(MAIN_GRAPH_ROUTE) }
    val goalListViewModel: ProjectHierarchyScreenViewModel = hiltViewModel(parentEntry)

    val uiState by goalListViewModel.uiState.collectAsStateWithLifecycle()

    ManageContextsScreen(
      initialContexts = uiState.allContexts,
      onBack = { navController.popBackStack() },
      onSave = { updatedContexts ->
        goalListViewModel.onEvent(ProjectHierarchyScreenEvent.SaveAllContexts(updatedContexts))
        navController.popBackStack()
      },
    )
  }

  composable("activity_tracker_screen") { ActivityTrackerScreen(navController = navController) }

  composable(
    route = "project_settings_screen?goalId={goalId}&projectId={projectId}",
    arguments =
      listOf(
        navArgument("goalId") {
          type = NavType.StringType
          nullable = true
        },
        navArgument("projectId") {
          type = NavType.StringType
          nullable = true
        },
      ),
  ) {
    ProjectSettingsScreen(navController = navController, viewModel = hiltViewModel())
  }

  composable(
    route = "goal_settings_screen/{goalId}",
    arguments = listOf(navArgument("goalId") { type = NavType.StringType }),
  ) {
    com.romankozak.forwardappmobile.ui.screens.goalsettings.GoalSettingsScreen(
      navController = navController,
      viewModel = hiltViewModel(),
    )
  }

  composable("sync_screen") {
    SyncScreen(
      syncDataViewModel = syncDataViewModel,
      onSyncComplete = { navController.popBackStack() },
    )
  }

  // Об'єднаний екран для перегляду/редагування існуючого списку
  composable(
    route = "note_document_screen/{documentId}?startEdit={startEdit}",
    arguments =
      listOf(
        navArgument("documentId") { type = NavType.StringType },
        navArgument("startEdit") {
          type = NavType.BoolType
          defaultValue = false
        },
      ),
  ) { backStackEntry ->
    val startEdit = backStackEntry.arguments?.getBoolean("startEdit") ?: false
    NoteDocumentEditorScreen(navController = navController, startEdit = startEdit)
  }

  composable(
    route = "note_document_create_screen/{projectId}",
    arguments = listOf(navArgument("projectId") { type = NavType.StringType }),
  ) {
    NoteDocumentScreen(navController = navController)
  }

  composable(
    route = "note_document_edit_screen?projectId={projectId}&documentId={documentId}",
    arguments =
      listOf(
        navArgument("projectId") {
          type = NavType.StringType
          nullable = true
        },
        navArgument("documentId") {
          type = NavType.StringType
          nullable = true
        },
      ),
  ) {
    NoteDocumentScreen(navController = navController)
  }

  composable(
    route = "script_editor_screen?projectId={projectId}&scriptId={scriptId}",
    arguments =
      listOf(
        navArgument("projectId") {
          type = NavType.StringType
          nullable = true
          defaultValue = null
        },
        navArgument("scriptId") {
          type = NavType.StringType
          nullable = true
          defaultValue = null
        },
      ),
  ) {
    ScriptEditorScreen(navController = navController)
  }

  composable(
    route = "checklist_screen?projectId={projectId}&checklistId={checklistId}",
    arguments =
      listOf(
        navArgument("projectId") {
          type = NavType.StringType
          nullable = true
        },
        navArgument("checklistId") {
          type = NavType.StringType
          nullable = true
        },
      ),
  ) {
    com.romankozak.forwardappmobile.ui.screens.checklist.ChecklistScreen(
      navController = navController
    )
  }

  composable(
    route =
      "list_chooser_screen/{title}?currentParentId={currentParentId}&disabledIds={disabledIds}",
    arguments =
      listOf(
        navArgument("title") { type = NavType.StringType },
        navArgument("currentParentId") {
          type = NavType.StringType
          nullable = true
        },
        navArgument("disabledIds") {
          type = NavType.StringType
          nullable = true
        },
      ),
  ) { backStackEntry ->
    val viewModel: FilterableListChooserViewModel = hiltViewModel()
    val TAG = "MOVE_DEBUG"

    val title =
      backStackEntry.arguments?.getString("title")?.let { URLDecoder.decode(it, "UTF-8") }
        ?: "Select a list"

    val disabledIds =
      backStackEntry.arguments?.getString("disabledIds")?.split(",")?.toSet() ?: emptySet()
    val currentParentIdArg = backStackEntry.arguments?.getString("currentParentId")
    val currentParentId = if (currentParentIdArg == "root") null else currentParentIdArg

    Log.d(TAG, "[Nav] list_chooser_screen launched.")

    val chooserUiState by viewModel.chooserState.collectAsStateWithLifecycle()
    val filterText by viewModel.filterText.collectAsStateWithLifecycle()
    val expandedIds by viewModel.expandedIds.collectAsStateWithLifecycle()
    val showDescendants by viewModel.showDescendants.collectAsStateWithLifecycle()

    FilterableListChooserScreen(
      title = title,
      filterText = filterText,
      onFilterTextChanged = viewModel::updateFilterText,
      chooserUiState = chooserUiState,
      expandedIds = expandedIds,
      onToggleExpanded = viewModel::toggleExpanded,
      onNavigateBack = { navController.popBackStack() },
      onConfirm = { selectedId ->
        navController.previousBackStackEntry
          ?.savedStateHandle
          ?.set("list_chooser_result", selectedId ?: "root")

        navController.popBackStack()
      },
      currentParentId = currentParentId,
      disabledIds = disabledIds,
      onAddNewList = viewModel::addNewProject,
      showDescendants = showDescendants,
      onToggleShowDescendants = viewModel::toggleShowDescendants,
    )
  }
  chatScreen(navController)
  dayManagementGraph(navController)
  dayManagementScreen(navController)
  strategicManagementScreen(navController)

  composable("tactical_management_screen") { TacticalManagementScreen() }

  composable(AI_INSIGHTS_ROUTE) { AiInsightsScreen(navController = navController) }

  composable("reminders_screen") { RemindersScreen(navController = navController) }

  composable(
    route = "edit_task_screen/{taskId}",
    arguments = listOf(navArgument("taskId") { type = NavType.StringType }),
  ) {
    EditTaskScreen(onNavigateUp = { navController.navigateUp() })
  }

  composable(
    route = "inbox_editor_screen/{inboxId}",
    arguments = listOf(navArgument("inboxId") { type = NavType.StringType }),
  ) {
    InboxEditorScreen(navController = navController)
  }

  composable(
    route = SELECTIVE_IMPORT_ROUTE,
    arguments = listOf(navArgument("fileUri") { type = NavType.StringType }),
  ) { backStackEntry ->
    val fileUri =
      backStackEntry.arguments?.getString("fileUri")?.let { URLDecoder.decode(it, "UTF-8") }
    if (fileUri != null) {
      com.romankozak.forwardappmobile.ui.screens.selectiveimport.SelectiveImportScreen(
        onNavigateBack = { navController.popBackStack() }
      )
    } else {
      // Handle error: URI is missing. Maybe pop back or show an error message.
      navController.popBackStack()
    }
  }
}

fun mapTargetToRoute(target: NavTarget): String =
    when (target) {
        NavTarget.ProjectHierarchy -> "goal_lists_screen"

        is NavTarget.ProjectDetail ->
            if (target.initialViewMode != null)
                "goal_detail_screen/${target.projectId}?initialViewMode=${target.initialViewMode}"
            else
                "goal_detail_screen/${target.projectId}"

        is NavTarget.NoteDocument ->
            "note_document_screen/${target.id}"

        is NavTarget.Checklist ->
            "checklist_screen?checklistId=${target.id}"

        is NavTarget.GlobalSearch ->
            "global_search_screen/${target.query}"

        NavTarget.Settings -> "settings_screen"
        NavTarget.Reminders -> "reminders_screen"
        NavTarget.Tracker -> "activity_tracker_screen"
        NavTarget.AiInsights -> "ai_insights_screen"
        NavTarget.LifeState -> "life_state_screen"
        NavTarget.AttachmentsLibrary -> "attachments_library_screen"
        NavTarget.ScriptsLibrary -> "scripts_library_screen"

        is NavTarget.ImportExport ->
            if (target.uri != null)
                "selective_import_screen/${java.net.URLEncoder.encode(target.uri, "UTF-8")}"
            else
                "selective_import_screen"
    }


================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/routes/AppNavigation.kt
================================================================================

## <<FILE_5>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/components/NewRecentListsSheet.kt (ID: FILE_5)
================================================================================

package com.romankozak.forwardappmobile.ui.components

import androidx.compose.foundation.ExperimentalFoundationApi
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.grid.GridCells
import androidx.compose.foundation.lazy.grid.LazyVerticalGrid
import androidx.compose.foundation.lazy.grid.items
import androidx.compose.foundation.pager.HorizontalPager
import androidx.compose.foundation.pager.rememberPagerState
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.outlined.List
import androidx.compose.material.icons.automirrored.outlined.Note
import androidx.compose.material.icons.filled.PushPin
import androidx.compose.material.icons.outlined.Folder
import androidx.compose.material.icons.outlined.Link
import androidx.compose.material.icons.outlined.PushPin
import androidx.compose.material.icons.outlined.Checklist
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import com.romankozak.forwardappmobile.data.database.models.RecentItem
import com.romankozak.forwardappmobile.data.database.models.RecentItemType
import kotlinx.coroutines.launch

@OptIn(ExperimentalMaterial3Api::class, ExperimentalFoundationApi::class)
@Composable
fun NewRecentListsSheet(
    showSheet: Boolean,
    recentItems: List<RecentItem>,
    onDismiss: () -> Unit,
    onItemClick: (RecentItem) -> Unit,
    onPinClick: (RecentItem) -> Unit,
) {
    if (showSheet) {
        ModalBottomSheet(
            onDismissRequest = onDismiss,
            containerColor = MaterialTheme.colorScheme.surfaceContainerHigh
        ) {
            val tabs = listOf("Недавні", "Закріплені")
            val pagerState = rememberPagerState { tabs.size }
            val coroutineScope = rememberCoroutineScope()

            Column(Modifier.navigationBarsPadding()) {
                TabRow(
                    selectedTabIndex = pagerState.currentPage,
                    containerColor = Color.Transparent
                ) {
                    tabs.forEachIndexed { index, title ->
                        Tab(
                            selected = pagerState.currentPage == index,
                            onClick = { coroutineScope.launch { pagerState.animateScrollToPage(index) } },
                            text = { Text(text = title) }
                        )
                    }
                }

                HorizontalPager(
                    state = pagerState,
                    modifier = Modifier.fillMaxWidth()
                ) {
                    page ->
                    val items = if (page == 0) recentItems else recentItems.filter { it.isPinned }
                    RecentItemsGrid(items = items, onItemClick = onItemClick, onPinClick = onPinClick)
                }
            }
        }
    }
}

@Composable
private fun RecentItemsGrid(
    items: List<RecentItem>,
    onItemClick: (RecentItem) -> Unit,
    onPinClick: (RecentItem) -> Unit
) {
    if (items.isEmpty()) {
        Box(
            modifier = Modifier.fillMaxSize().padding(16.dp),
            contentAlignment = Alignment.Center
        ) {
            Text(
                text = "Історія порожня.",
                style = MaterialTheme.typography.bodyMedium,
            )
        }
    } else {
        LazyVerticalGrid(
            columns = GridCells.Adaptive(minSize = 150.dp),
            contentPadding = PaddingValues(16.dp),
            horizontalArrangement = Arrangement.spacedBy(16.dp),
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            items(items, key = { it.id }) { item ->
                RecentItemCard(item = item, onClick = { onItemClick(item) }, onPinClick = { onPinClick(item) })
            }
        }
    }
}

@Composable
private fun RecentItemCard(
    item: RecentItem,
    onClick: () -> Unit,
    onPinClick: () -> Unit
) {
    val color = getColorsForType(item.type)
    Card(
        modifier = Modifier
            .aspectRatio(1.3f)
            .clickable(onClick = onClick)
            .border(
                width = 1.dp,
                color = color,
                shape = MaterialTheme.shapes.medium
            ),
        shape = MaterialTheme.shapes.medium,
        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surfaceContainerHigh)
    ) {
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(12.dp),
            verticalArrangement = Arrangement.SpaceBetween
        ) {
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.Top
            ) {
                Icon(
                    imageVector = when (item.type) {
                        RecentItemType.PROJECT -> Icons.Outlined.Folder
                        RecentItemType.NOTE -> Icons.AutoMirrored.Outlined.Note
                        RecentItemType.NOTE_DOCUMENT -> Icons.AutoMirrored.Outlined.List
                        RecentItemType.CHECKLIST -> Icons.Outlined.Checklist
                        RecentItemType.OBSIDIAN_LINK -> Icons.Outlined.Link
                    },
                    contentDescription = null,
                    modifier = Modifier.size(36.dp),
                    tint = color
                )
                IconButton(onClick = onPinClick, modifier = Modifier.size(24.dp)) {
                    Icon(
                        imageVector = if (item.isPinned) Icons.Filled.PushPin else Icons.Outlined.PushPin,
                        contentDescription = "Pin",
                        tint = color,
                        modifier = Modifier.size(18.dp)
                    )
                }
            }
            Text(
                text = item.displayName,
                style = MaterialTheme.typography.bodyLarge.copy(fontWeight = FontWeight.Bold),
                color = color,
                maxLines = 3
            )
        }
    }
}

@Composable
private fun getColorsForType(type: RecentItemType): Color {
    return when (type) {
        RecentItemType.PROJECT -> MaterialTheme.colorScheme.primary
        RecentItemType.NOTE -> MaterialTheme.colorScheme.secondary
        RecentItemType.NOTE_DOCUMENT -> MaterialTheme.colorScheme.tertiary
        RecentItemType.CHECKLIST -> MaterialTheme.colorScheme.tertiaryContainer
        RecentItemType.OBSIDIAN_LINK -> MaterialTheme.colorScheme.primaryContainer
    }
}


================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/components/NewRecentListsSheet.kt
================================================================================

## <<FILE_6>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/navigation/NavigationDispatcher.kt (ID: FILE_6)
================================================================================

package com.romankozak.forwardappmobile.ui.navigation

interface NavigationDispatcher {
    fun navigate(route: String)
    fun popBackStack(key: String? = null, value: String? = null)
}


================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/navigation/NavigationDispatcher.kt
================================================================================

## <<FILE_7>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentUiEvent.kt (ID: FILE_7)
================================================================================

[Помилка читання файлу /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentUiEvent.kt: [Errno 2] No such file or directory: '/home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentUiEvent.kt']


================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentUiEvent.kt
================================================================================

## <<FILE_8>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentViewModel.kt (ID: FILE_8)
================================================================================

package com.romankozak.forwardappmobile.ui.recent

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.romankozak.forwardappmobile.data.database.models.RecentItem
import com.romankozak.forwardappmobile.data.repository.RecentItemsRepository
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.flow.SharingStarted
import kotlinx.coroutines.flow.stateIn
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class RecentViewModel @Inject constructor(
    private val recentItemsRepository: RecentItemsRepository
) : ViewModel() {

    val recentItems = recentItemsRepository.getRecentItems(100)
        .stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), emptyList())

    fun onPinClick(item: RecentItem) {
        viewModelScope.launch {
            recentItemsRepository.updateRecentItem(item.copy(isPinned = !item.isPinned))
        }
    }
}

================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/recent/RecentViewModel.kt
================================================================================

## <<FILE_9>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/screens/commanddeck/SharedCommandDeckLayout.kt (ID: FILE_9)
================================================================================

package com.romankozak.forwardappmobile.ui.screens.commanddeck

import com.romankozak.forwardappmobile.ui.recent.RecentViewModel
import androidx.hilt.navigation.compose.hiltViewModel
import android.util.Log
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.MaterialTheme
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.remember
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.compose.currentBackStackEntryAsState
import androidx.navigation.compose.rememberNavController
import com.romankozak.forwardappmobile.features.missions.presentation.TacticalManagementScreen
import com.romankozak.forwardappmobile.routes.STRATEGIC_MANAGEMENT_ROUTE
import com.romankozak.forwardappmobile.ui.components.header.CoreHeader
import com.romankozak.forwardappmobile.ui.components.header.CommandDeckHeaderPreset
import com.romankozak.forwardappmobile.ui.components.header.FAHeader
import com.romankozak.forwardappmobile.ui.components.header.FAHeaderBackground
import com.romankozak.forwardappmobile.ui.components.header.StrategicArcHeader
import com.romankozak.forwardappmobile.ui.components.header.StrategyHeader
import com.romankozak.forwardappmobile.ui.components.header.TacticsHeader
import com.romankozak.forwardappmobile.ui.components.header.TodayHeader
import com.romankozak.forwardappmobile.ui.screens.daymanagement.DayManagementScreen
import com.romankozak.forwardappmobile.ui.screens.daymanagement.dayplan.DayPlanViewModel
import com.romankozak.forwardappmobile.ui.screens.strategicmanagement.StrategicManagementScreen
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.material3.Scaffold
import com.romankozak.forwardappmobile.ui.screens.commanddeck.components.DashboardBottomBar
import com.romankozak.forwardappmobile.ui.components.header.CommandDeckBackgroundModifier
import androidx.compose.foundation.layout.Box
import androidx.compose.ui.draw.clip
import androidx.compose.foundation.shape.RoundedCornerShape
import com.romankozak.forwardappmobile.data.database.models.RecentItem
import androidx.compose.ui.unit.dp
import androidx.compose.foundation.layout.fillMaxWidth

const val COMMAND_DECK_DASHBOARD_ROUTE = "command_deck_dashboard"
const val COMMAND_DECK_CORE_ROUTE = "command_deck_core"
const val COMMAND_DECK_STRATEGIC_ARC_ROUTE = "command_deck_strategic_arc"
const val COMMAND_DECK_TACTICS_ROUTE = "command_deck_tactics"
const val COMMAND_DECK_TODAY_ROUTE = "command_deck_today"




@Composable
fun SharedCommandDeckLayout(
    navController: NavController,
    onNavigateToProjectHierarchy: () -> Unit,
    onNavigateToGlobalSearch: () -> Unit,
    onNavigateToSettings: () -> Unit,
    onNavigateToInbox: () -> Unit,
    onNavigateToTracker: () -> Unit,
    onNavigateToReminders: () -> Unit,
    onNavigateToAiChat: () -> Unit,
    onNavigateToAiLifeManagement: () -> Unit,
    onNavigateToImportExport: () -> Unit,
    onNavigateToAttachments: () -> Unit,
    onNavigateToScripts: () -> Unit,
    onNavigateToRecentItem: (RecentItem) -> Unit,
    recentViewModel: RecentViewModel = hiltViewModel<RecentViewModel>()
) {
    val tabs = CommandDeckTab.entries.toList()
    val innerNavController = rememberNavController()

    val navBackStackEntry by innerNavController.currentBackStackEntryAsState()
    val currentRoute = navBackStackEntry?.destination?.route

    val selectedTabIndex = remember(currentRoute) {
        tabs.indexOfFirst { tab ->
            when (tab) {
                CommandDeckTab.Dashboard -> currentRoute == COMMAND_DECK_DASHBOARD_ROUTE
                CommandDeckTab.Core -> currentRoute == COMMAND_DECK_CORE_ROUTE
                CommandDeckTab.Strategy -> currentRoute == STRATEGIC_MANAGEMENT_ROUTE
                CommandDeckTab.StrategicArc -> currentRoute == COMMAND_DECK_STRATEGIC_ARC_ROUTE
                CommandDeckTab.Tactics -> currentRoute == COMMAND_DECK_TACTICS_ROUTE
                CommandDeckTab.Today -> currentRoute == COMMAND_DECK_TODAY_ROUTE
            }
        }.coerceAtLeast(0)
    }

    Scaffold(
        containerColor = Color.Transparent,
        topBar = {
            when (currentRoute) {
                COMMAND_DECK_DASHBOARD_ROUTE -> FAHeader(
                    layout = CommandDeckHeaderPreset(onClick = onNavigateToProjectHierarchy),
                    backgroundStyle = FAHeaderBackground.CommandDeck
                )

                COMMAND_DECK_CORE_ROUTE -> FAHeader(
                    layout = CoreHeader(),
                    backgroundStyle = FAHeaderBackground.CommandDeck
                )

                COMMAND_DECK_TODAY_ROUTE -> {
                    val dayPlanBackStackEntry = remember(innerNavController.currentBackStackEntry) {
                        innerNavController.getBackStackEntry(COMMAND_DECK_TODAY_ROUTE)
                    }
                    val dayPlanViewModel: DayPlanViewModel = hiltViewModel(dayPlanBackStackEntry)
                    val dayPlanUiState by dayPlanViewModel.uiState.collectAsState()

                    FAHeader(
                        layout = TodayHeader(
                            onNavigateToPreviousDay = {
                                Log.d("TodayTab", "onNavigateToPreviousDay callback invoked.")
                                dayPlanViewModel.navigateToPreviousDay()
                            },
                            onNavigateToNextDay = {
                                Log.d(
                                    "TodayTab",
                                    "onNavigateToNextDay callback invoked. Enabled: ${!dayPlanUiState.isToday}"
                                )
                                dayPlanViewModel.navigateToNextDay()
                            },
                            isNextDayNavigationEnabled = !dayPlanUiState.isToday,
                            date = dayPlanUiState.dayPlan?.date
                        ),
                        backgroundStyle = FAHeaderBackground.CommandDeck
                    )
                }

                STRATEGIC_MANAGEMENT_ROUTE -> FAHeader(
                    layout = StrategyHeader(onModeClick = {}),
                    backgroundStyle = FAHeaderBackground.CommandDeck
                )

                COMMAND_DECK_STRATEGIC_ARC_ROUTE -> FAHeader(
                    layout = StrategicArcHeader(onModeClick = {}),
                    backgroundStyle = FAHeaderBackground.CommandDeck
                )

                COMMAND_DECK_TACTICS_ROUTE -> FAHeader(
                    layout = TacticsHeader(),
                    backgroundStyle = FAHeaderBackground.CommandDeck
                )

                else -> FAHeader(
                    layout = CommandDeckHeaderPreset(onClick = {}),
                    backgroundStyle = FAHeaderBackground.CommandDeck
                )
            }
        },
        bottomBar = {
            if (currentRoute == COMMAND_DECK_DASHBOARD_ROUTE) {
                Box(modifier = Modifier
                    .fillMaxWidth()
                    .padding(horizontal = 16.dp, vertical = 12.dp)
                    .clip(RoundedCornerShape(20.dp))
                    .then(CommandDeckBackgroundModifier())
                    .padding(horizontal = 22.dp, vertical = 12.dp)
                ) {
                    DashboardBottomBar(
                        onNavigateToProjectHierarchy = onNavigateToProjectHierarchy,
                        onNavigateToTracker = onNavigateToTracker,
                        onNavigateToInbox = onNavigateToInbox,
                        onNavigateToReminders = onNavigateToReminders,
                        onNavigateToRecentItem = onNavigateToRecentItem,
                        recentViewModel = recentViewModel
                    )
                }
            }
        }
    ) { paddingValues ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(paddingValues)
                .background(Color.Transparent)
        ) {
            Spacer(Modifier.height(8.dp))

            CommandDeckTabRow(
                tabs = tabs,
                selectedTabIndex = selectedTabIndex,
                onTabSelected = { index ->
                    val newRoute = when (tabs[index]) {
                        CommandDeckTab.Dashboard -> COMMAND_DECK_DASHBOARD_ROUTE
                        CommandDeckTab.Core -> COMMAND_DECK_CORE_ROUTE
                        CommandDeckTab.Strategy -> STRATEGIC_MANAGEMENT_ROUTE
                        CommandDeckTab.StrategicArc -> COMMAND_DECK_STRATEGIC_ARC_ROUTE
                        CommandDeckTab.Tactics -> COMMAND_DECK_TACTICS_ROUTE
                        CommandDeckTab.Today -> COMMAND_DECK_TODAY_ROUTE
                    }
                    if (newRoute != currentRoute) {
                        innerNavController.navigate(newRoute) {
                            popUpTo(innerNavController.graph.startDestinationId) {
                                saveState = true
                            }
                            launchSingleTop = true
                            restoreState = true
                        }
                    }
                }
            )

            Spacer(Modifier.height(16.dp))

            NavHost(
                navController = innerNavController,
                startDestination = COMMAND_DECK_DASHBOARD_ROUTE
            ) {
                composable(COMMAND_DECK_DASHBOARD_ROUTE) {
                    AnimatedCommandDeck(
                        onNavigateToProjectHierarchy = onNavigateToProjectHierarchy,
                        onNavigateToGlobalSearch = onNavigateToGlobalSearch,
                        onNavigateToSettings = onNavigateToSettings,
                        onNavigateToInbox = onNavigateToInbox,
                        onNavigateToTracker = onNavigateToTracker,
                        onNavigateToReminders = onNavigateToReminders,
                        onNavigateToAiChat = onNavigateToAiChat,
                        onNavigateToAiLifeManagement = onNavigateToAiLifeManagement,
                        onNavigateToImportExport = onNavigateToImportExport,
                        onNavigateToAttachments = onNavigateToAttachments,
                        onNavigateToScripts = onNavigateToScripts
                    )
                }
                composable(STRATEGIC_MANAGEMENT_ROUTE) {
                    StrategicManagementScreen(navController = navController)
                }
                composable(COMMAND_DECK_CORE_ROUTE) {
                    CoreLevelScreen(navController = navController)
                }
                composable(COMMAND_DECK_STRATEGIC_ARC_ROUTE) {
                    StrategicArcScreen(navController = navController)
                }
                composable(COMMAND_DECK_TACTICS_ROUTE) {
                    TacticalManagementScreen()
                }
                composable(COMMAND_DECK_TODAY_ROUTE) {
                    DayManagementScreen(mainNavController = navController, startTab = "PLAN")
                }
            }
        }
    }
}



================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/screens/commanddeck/SharedCommandDeckLayout.kt
================================================================================

## <<FILE_10>>
================================================================================
BEGIN FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/screens/commanddeck/components/DashboardBottomBar.kt (ID: FILE_10)
================================================================================

package com.romankozak.forwardappmobile.ui.screens.commanddeck.components

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.interaction.MutableInteractionSource
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.outlined.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.tooling.preview.Preview
import androidx.compose.ui.unit.dp
import androidx.hilt.navigation.compose.hiltViewModel
import androidx.lifecycle.compose.collectAsStateWithLifecycle
import com.romankozak.forwardappmobile.data.database.models.RecentItem
import com.romankozak.forwardappmobile.ui.components.NewRecentListsSheet
import com.romankozak.forwardappmobile.ui.recent.RecentViewModel
import kotlinx.coroutines.launch

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun DashboardBottomBar(
    onNavigateToProjectHierarchy: () -> Unit,
    onNavigateToTracker: () -> Unit,
    onNavigateToInbox: () -> Unit,
    onNavigateToReminders: () -> Unit,
    onNavigateToRecentItem: (RecentItem) -> Unit,
    recentViewModel: RecentViewModel = hiltViewModel()
) {
    val coroutineScope = rememberCoroutineScope()
    val modalSheetState = rememberModalBottomSheetState(
        skipPartiallyExpanded = true,
    )
    var showMoreBottomSheet by remember { mutableStateOf(false) }
    var showRecentSheet by remember { mutableStateOf(false) }

    val recentItems by recentViewModel.recentItems.collectAsStateWithLifecycle()

    if (showMoreBottomSheet) {
        ModalBottomSheet(
            onDismissRequest = { showMoreBottomSheet = false },
            sheetState = modalSheetState,
            shape = RoundedCornerShape(topStart = 12.dp, topEnd = 12.dp),
        ) {
            MoreBottomSheetContent(onNavigateToReminders = {
                coroutineScope.launch { modalSheetState.hide() }.invokeOnCompletion {
                    if (!modalSheetState.isVisible) {
                        showMoreBottomSheet = false
                    }
                    onNavigateToReminders()
                }
            })
        }
    }

    if (showRecentSheet) {
        NewRecentListsSheet(
            showSheet = showRecentSheet,
            recentItems = recentItems,
            onDismiss = { showRecentSheet = false },
            onItemClick = { item ->
                coroutineScope.launch { modalSheetState.hide() }.invokeOnCompletion {
                    showRecentSheet = false
                    onNavigateToRecentItem(item)
                }
            },
            onPinClick = { item -> recentViewModel.onPinClick(item) }
        )
    }

    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = Arrangement.SpaceAround,
        verticalAlignment = Alignment.CenterVertically
    ) {
        BarButton(
            icon = Icons.Outlined.Inbox,
            label = "Inbox",
            onClick = onNavigateToInbox
        )

        BarButton(
            icon = Icons.Outlined.Analytics,
            label = "Tracker",
            onClick = onNavigateToTracker
        )

        BarButton(
            icon = Icons.Outlined.AccountTree,
            onClick = onNavigateToProjectHierarchy,
            label = "Projects",
        )
        BarButton(
            icon = Icons.Outlined.History,
            label = "Recent",
            onClick = { showRecentSheet = true }
        )
        BarButton(
            icon = Icons.Outlined.MoreHoriz,
            label = "More",
            onClick = { showMoreBottomSheet = true }
        )
    }
}

@Composable
private fun MoreBottomSheetContent(onNavigateToReminders: () -> Unit) {
    Box(
        modifier = Modifier
            .fillMaxWidth()
            .background(MaterialTheme.colorScheme.surface)
            .padding(16.dp)
    ) {
        Column {
            Text("More Options", style = MaterialTheme.typography.headlineSmall)
            Spacer(modifier = Modifier.height(16.dp))
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .clickable(onClick = onNavigateToReminders)
                    .padding(vertical = 8.dp),
                verticalAlignment = Alignment.CenterVertically
            ) {
                Icon(Icons.Outlined.Notifications, contentDescription = "Reminders")
                Spacer(modifier = Modifier.width(16.dp))
                Text("Reminders")
            }
        }
    }
}


@Composable
private fun BarButton(
    icon: androidx.compose.ui.graphics.vector.ImageVector,
    label: String,
    onClick: () -> Unit
) {
    val primary = MaterialTheme.colorScheme.primary

    Column(
        horizontalAlignment = Alignment.CenterHorizontally,
        modifier = Modifier
            .clip(RoundedCornerShape(14.dp))
            .clickable(
                interactionSource = remember { MutableInteractionSource() },
                indication = null,
            ) { onClick() }
            .padding(6.dp)
    ) {
        Box(
            modifier = Modifier
                .size(36.dp)
                .clip(CircleShape)
                .background(primary.copy(alpha = 0.10f))
                .border(
                    width = 1.dp,
                    color = primary.copy(alpha = 0.22f),
                    shape = CircleShape
                ),
            contentAlignment = Alignment.Center
        ) {
            Icon(icon, contentDescription = label, tint = primary.copy(alpha = 0.9f))
        }
    }
}

@Preview
@Composable
fun DashboardBottomBarPreview() {
    DashboardBottomBar(
        onNavigateToProjectHierarchy = {},
        onNavigateToTracker = {},
        onNavigateToInbox = {},
        onNavigateToReminders = {},
        onNavigateToRecentItem = {},
        recentViewModel = hiltViewModel()
    )
}

================================================================================
END FILE: /home/romankozak/studio/public/forwardapp-suit/forwardapp-android/app/src/main/java/com/romankozak/forwardappmobile/ui/screens/commanddeck/components/DashboardBottomBar.kt
================================================================================

