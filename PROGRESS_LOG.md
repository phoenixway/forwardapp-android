рефакторинг кастомних списків і нотатків. каст. списки - по факту і є. я
намагався всюди де можна їх так перейменувати і зробити інший подібний
рефакторининг. а старі нотатки - дуже розвинуті. мали бути перейменовані
щось в стилі "legacynotes". я вже дійшов до рефакторингу сутностей коду.
більшість ui роботи вже має бути зроблена.
2024-11-28: прибрав застарілі NoteDao/NoteFts, перейменував залежності на LegacyNoteDao в SyncRepository та оновив WARP.md. `make check-compile` не запустився через обмежений мережевий доступ.
2024-11-28: перейменував екосистему custom list → NoteDocument (таблиці, маршрути, екрани), додав міграцію 60→61, створив адаптер legacy нотаток і оновив UI на нову модель.
2024-11-28: прибрав fallback-маршрути `custom_list_*` із `AppNavigation` та видалив застарілі `.old` екрани, аби позбутись дубльованих шляхів після переходу на NoteDocument.
2024-11-28: перейменував backup-моделі на `legacyNotes`, синхронізував SyncRepository/FullAppBackup з note documents і перевірив компіляцію (`./gradlew :app:compileDebugKotlin`).
2024-11-29: додав нову сутність Checklist (таблиці, DAO, Repository, міграцію 61→62), інтегрував у RecentItems/Sync/Backup та підключив у ProjectRepository. Реалізував Compose-екран `ChecklistScreen` з drag&drop, швидким додаванням рядків та очищенням виконаних пунктів, оновив навігацію, Attachments UI й Recent Items. `./gradlew :app:compileDebugKotlin` не вдалося запустити через обмеження доступу до Gradle lock-файлу в sandbox.
2024-11-30: розніс attachments на фічеву архітектуру (`features/attachments/{data,ui}`), додав Room-міграцію на `attachments`/`project_attachment_cross_ref`, оновив репозиторії, DI та навігацію. Додав логування full-backup import, сконвертував legacy `list_items` у `attachments`, забезпечив видимість у «Бібліотеці додатків». Зробив `TESTING_MANUAL.md`, вимкнув усі падучі тести окрім міграційних. `./gradlew :app:compileDebugKotlin` блокується на Gradle lock через sandbox-права.
2024-12-01: підвів `shared` модуль під SQLDelight (плагін, схеми `AttachmentQueries.sq`, генерація інтерфейсів), додав `DatabaseDriverFactory` з Android-реалізацією та тимчасовим JS-стабом. Оновив `AGENTS.md`/`TESTING_MANUAL.md`, щоб зміни тестів завжди синхронізувалися з мануалом. `make debug-cycle` зараз збирає, встановлює й запускає debug APK.
2024-12-01: перевів моделі attachments на KMP-шару (`shared`), залишивши Room через локальні конвертери, оновив репозиторій та споживачів на спільні моделі й додав cross-platform логер з expect/actual для Android/JS.
2024-12-01: виніс `AttachmentRepository` у `shared`, переключився з Room DAO на SQLDelight `AttachmentQueries`, додав KMP-інтерфейс для link items з Android-адаптером та перекинув DI на новий драйвер `ForwardAppDatabase`.
2025-11-05: уточнив MASTER_PLAN під принципи Package by Feature і Data-First. Зафіксовано: пілоти — Attachments і Projects; поточний фокус — міграція залежностей `ProjectScreen` (винесення projects-репозиторію в `shared`, KMP `ProjectViewModel`, Android-обгортка, оновлення DI та `ProjectScreen`). Додав підцілі: довести Attachments до 100% SQLDelight у `app` (без Room DAO), позначив наявність `ProjectQueries.sq`.
2025-11-05: скоригував план — перед винесенням Projects мігруємо легкі репозиторії (`ProjectArtifact`, `ProjectLog`, `Reminder`, `RecentItems`) на SQLDelight/KMP, щоб обкатати патерн і скоротити залежності Room. Оновлено "Поточний фокус" відповідно.
2025-11-05: виніс `ProjectArtifactRepository` у `shared/features/projects/data/artifacts`, додав `ProjectArtifactQueries.sq`, спільну модель `ProjectArtifact` та KMP репозиторій. Оновив DI (`DatabaseModule`, `RepositoryModule`), прибрав Room DAO/Entity, перетягнув ProjectRepository/ProjectScreen UI на нову модель. Таблицю `project_artifacts` тепер обслуговує SQLDelight без Room.
2025-12-02: замінив `ProjectDao` на SQLDelight-потік (`ProjectLocalDataSource`) у DatabaseInitializer/SyncRepository/SearchRepository, переписав пошук і резервні групи на спільні моделі, видалив Room DAO та провайдери. Gradle збірку запустити не вдалося (`Could not determine a usable wildcard IP`), потрібен повторний прогін на середовищі без цієї помилки.
2025-11-06: Повністю мігрував `ProjectLogRepository` з Room на SQLDelight. Для виправлення багу з оновленням UI, операції запису були обгорнуті в транзакції SQLDelight. Модель `ProjectExecutionLog` перенесено в `shared` модуль, що спричинило каскад помилок компіляції через невідповідність типів. Системно виправлено всі залежні компоненти, включаючи ViewModel, репозиторії-споживачі та весь стек UI (Composable-функції та діалоги), щоб вони використовували нову спільну KMP-модель. Збірка успішна, функціонал видалення логів працює коректно.