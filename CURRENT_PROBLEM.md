
# –ü–æ—Ç–æ—á–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: –ü–æ–º–∏–ª–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ SQLDelight —Ç–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏ –¥–ª—è —ñ–Ω—à–æ—ó –º–æ–≤–Ω–æ—ó –º–æ–¥–µ–ª—ñ

–ü—Ä–∏–≤—ñ—Ç! –Ø –ø—Ä–∞—Ü—é—é –Ω–∞–¥ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º Android-–ø—Ä–æ—î–∫—Ç—É, —â–æ–± —Å–ª—ñ–¥—É–≤–∞—Ç–∏ —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—ó "package by feature". –Ø –ø–æ—á–∞–≤ –∑ —Ñ—ñ—á—ñ `projects` —ñ –∑—ñ—Ç–∫–Ω—É–≤—Å—è –∑ –Ω–∏–∑–∫–æ—é –ø–æ–º–∏–ª–æ–∫ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ SQLDelight —Ç–∞ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–º –∫–æ–¥–æ–º.

**–û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞:** –ó–º—É—Å–∏—Ç–∏ –ø—Ä–æ—î–∫—Ç –∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏—Å—è –ø—ñ—Å–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É.

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:**
–Ø –Ω–∞–º–∞–≥–∞—é—Å—è —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ —Å—Ö–µ–º—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –Ω–∞ –¥–≤—ñ —á–∞—Å—Ç–∏–Ω–∏: `ForwardAppDatabase` (–¥–ª—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å, —Ç–∞–∫–∏—Ö —è–∫ `Goals` —Ç–∞ `ListItems`) —Ç–∞ `ProjectsDatabase` (–¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ `Projects`).

–Ø –ø–µ—Ä–µ–º—ñ—Å—Ç–∏–≤ —Ñ–∞–π–ª–∏ `.sq` —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, –æ–Ω–æ–≤–∏–≤ `build.gradle.kts` –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–≤–æ—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö —Ç–∞ –æ–Ω–æ–≤–∏–≤ –∫–æ–¥, —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—ñ –¥–≤—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

–û–¥–Ω–∞–∫, —è –ø–æ—Å—Ç—ñ–π–Ω–æ –æ—Ç—Ä–∏–º—É—é –ø–æ–º–∏–ª–∫–∏ `Unresolved reference` –¥–ª—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ SQLDelight —Ç–∞ —ó—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π, –∞ —Ç–∞–∫–æ–∂ –ø–æ–º–∏–ª–∫–∏ `Overload resolution ambiguity` —Ç–∞ `Cannot infer type for this parameter`.

**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:**
–Ø —â–æ–π–Ω–æ —É—Å–ø—ñ—à–Ω–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞–≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ SQLDelight, –ø–µ—Ä–µ–º—ñ—Å—Ç–∏–≤—à–∏ —Ñ–∞–π–ª–∏ `.sq` —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø–∞–∫–µ—Ç—ñ–≤ —Ç–∞ –æ–Ω–æ–≤–∏–≤—à–∏ `build.gradle.kts`. –û–¥–Ω–∞–∫, –∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –≤—Å–µ —â–µ –Ω–µ –≤–¥–∞—î—Ç—å—Å—è.

## –ü–æ–º–∏–ª–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó

```
e: file:///home/romankozak/studio/public/forwardapp-suit/forwardapp-android/shared/src/commonMain/kotlin/com/romankozak/forwardappm
obile/shared/core/data/database/Database.kt:79:9 No value passed for parameter 'ProjectsAdapter'.

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':shared:compileKotlinJvm'.
> A failure occurred while executing org.jetbrains.kotlin.compilerRunner.GradleCompilerRunnerWithWorkers$GradleKotlinCompilerWorkAc
tion
   > Compilation error. See log for more details
```

## –ó–Ω–∞—á–∏–º—ñ —Ñ–∞–π–ª–∏

*   `shared/build.gradle.kts`
*   `shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/core/data/database/Database.kt`
*   `shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/data/database/DatabaseInitializer.kt`
*   `shared/src/commonMain/sqldelight/com/romankozak/forwardappmobile/shared/core/data/database/Goals.sq`
*   `shared/src/commonMain/sqldelight/com/romankozak/forwardappmobile/shared/core/data/database/ListItems.sq`
*   `shared/src/commonMain/sqldelight/features/projects/com/romankozak/forwardappmobile/shared/features/projects/data/db/Projects.sq`
*   `shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/features/projects/data/mappers/ProjectMapper.kt`
*   `shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/features/projects/data/repository/ProjectRepositoryImpl.kt`

## –î–µ–º–æ-–∫–æ–¥ –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏

**`shared/build.gradle.kts` (–ø–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è `sqldelight`):**
```kotlin
sqldelight {
    databases {
        create("ForwardAppDatabase") {
            packageName.set("com.romankozak.forwardappmobile.shared.core.data.database")
            srcDirs("src/commonMain/sqldelight")
        }
    }
}
```

**`shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/core/data/database/Database.kt`:**
```kotlin
package com.romankozak.forwardappmobile.shared.core.data.database

// ...

fun createForwardAppDatabase(driver: SqlDriver): ForwardAppDatabase {
    val goalsAdapter = Goals.Adapter(
        // ...
    )

    val listItemsAdapter = ListItems.Adapter(
        // ...
    )

    return ForwardAppDatabase(
        driver = driver,
        GoalsAdapter = goalsAdapter,
        ListItemsAdapter = listItemsAdapter
        // ERROR: No value passed for parameter 'ProjectsAdapter'
    )
}
```

## –ü–ª–∞–Ω –¥—ñ–π

1.  **–í–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É `No value passed for parameter 'ProjectsAdapter'`:**
    *   –ó—Ä–æ–∑—É–º—ñ—Ç–∏, —á–æ–º—É `ForwardAppDatabase` –≤—Å–µ —â–µ –æ—á—ñ–∫—É—î `ProjectsAdapter`, –Ω–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ —Ç–µ, —â–æ `Projects.sq` –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —ñ–Ω—à—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó.
    *   –Ø–∫—â–æ `ForwardAppDatabase` –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ, —Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ `ProjectsAdapter` –¥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `ForwardAppDatabase` –≤ `Database.kt`.
    *   –Ø–∫—â–æ `ForwardAppDatabase` –Ω–µ –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ `Projects`, —Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏, —á–æ–º—É `Projects.sq` –≤—Å–µ —â–µ —î —á–∞—Å—Ç–∏–Ω–æ—é —Å—Ö–µ–º–∏ `ForwardAppDatabase`.

2.  **–í–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ `Unresolved reference`:**
    *   –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –∫–ª–∞—Å–∏ SQLDelight –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ñ–º–ø–æ—Ä—Ç—É—é—Ç—å—Å—è.
    *   –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ `commonMain` source set –ø—Ä–∞–≤–∏–ª—å–Ω–æ –±–∞—á–∏—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏.

3.  **–í–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ `Overload resolution ambiguity` —Ç–∞ `Cannot infer type for this parameter`:**
    *   –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–≤–Ω—ñ —ñ–º–µ–Ω–∞ –¥–ª—è `toDomain()` —Ñ—É–Ω–∫—Ü—ñ–π-—Ä–æ–∑—à–∏—Ä–µ–Ω—å, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤.
    *   –í–∫–∞–∑–∞—Ç–∏ —Ç–∏–ø–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —è–≤–Ω–æ, –¥–µ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –Ω–µ –º–æ–∂–µ —ó—Ö –≤–∏–≤–µ—Å—Ç–∏.

## –©–æ –º–∏ –ø—Ä–æ–±—É–≤–∞–ª–∏

*   **–†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è `sqldelight` –Ω–∞ –¥–≤—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:**
    *   –°—Ç–≤–æ—Ä—é–≤–∞–ª–∏ –¥–≤–∞ `create` –±–ª–æ–∫–∏ –≤ `build.gradle.kts` –¥–ª—è `ForwardAppDatabase` —Ç–∞ `ProjectsDatabase`.
    *   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–º–∏–ª–∫–∏ `Unresolved reference` –¥–ª—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ —Ç–∞ —ó—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π.

*   **–ó–º—ñ–Ω–∞ `srcDirs` —Ç–∞ `packageName`:**
    *   –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É–≤–∞–ª–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è–º–∏ `srcDirs` —Ç–∞ `packageName` –≤ `build.gradle.kts`.
    *   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ—Å—Ç—ñ–π–Ω—ñ –ø–æ–º–∏–ª–∫–∏ `SqlDelight files must be placed in a package directory.`.

*   **–ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è `.sq` —Ñ–∞–π–ª—ñ–≤:**
    *   –ü–µ—Ä–µ–º—ñ—â—É–≤–∞–ª–∏ `.sq` —Ñ–∞–π–ª–∏ –≤ —Ä—ñ–∑–Ω—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, —â–æ–± –∑–∞–¥–æ–≤–æ–ª—å–Ω–∏—Ç–∏ –≤–∏–º–æ–≥–∏ SQLDelight —â–æ–¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø–∞–∫–µ—Ç—ñ–≤.
    *   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–¥–∞–ª–æ—Å—è —É—Å–ø—ñ—à–Ω–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ SQLDelight, –∞–ª–µ –ø–æ–º–∏–ª–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –∑–∞–ª–∏—à–∏–ª–∏—Å—è.

*   **–û—á–∏—â–µ–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–∑–±–∏—Ä–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É:**
    *   –í–∏–∫–æ–Ω—É–≤–∞–ª–∏ `./gradlew clean` —Ç–∞ `./gradlew :shared:compileKotlinJvm`.
    *   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–º–∏–ª–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –Ω–µ –∑–Ω–∏–∫–ª–∏.

–Ø –≥–æ—Ç–æ–≤–∏–π –Ω–∞–¥–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –∫–æ–¥ –∞–±–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫–∞ –º–æ–∂–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è —Ü—ñ—î—ó –ø—Ä–æ–±–ª–µ–º–∏.


## shared/build.gradle.kts
```kotlin
import org.jetbrains.kotlin.gradle.dsl.JvmTarget

plugins {
    alias(libs.plugins.kotlinMultiplatform)
    alias(libs.plugins.kotlinSerialization)
    alias(libs.plugins.androidLibrary)
    // alias(libs.plugins.sqldelight) // Commented out
    id("app.cash.sqldelight") // ‚úÖ —è–≤–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è, –≥–∞—Ä–∞–Ω—Ç—É—î —Ä–æ–±–æ—Ç—É –ø–ª–∞–≥—ñ–Ω–∞
    alias(libs.plugins.ksp)
}

// üß© Workaround –¥–ª—è Compose Native initialization bug
System.setProperty("org.jetbrains.kotlin.native.ignoreDisabledTargets", "true")

kotlin {
    @OptIn(org.jetbrains.kotlin.gradle.ExperimentalKotlinGradlePluginApi::class)

    // ‚úÖ Android target
    androidTarget {
        compilerOptions {
            jvmTarget.set(JvmTarget.JVM_17)
            freeCompilerArgs.add("-Xexpect-actual-classes")
        }
    }

    // ‚úÖ JVM target
    jvm {
        compilerOptions {
            jvmTarget.set(JvmTarget.JVM_17)
            freeCompilerArgs.add("-Xexpect-actual-classes")
        }
    }

    sourceSets {
        val commonMain by getting {
            kotlin.srcDir("build/generated/sqldelight/code/ForwardAppDatabase/commonMain")
            kotlin.srcDir("build/generated/sqldelight/code/ProjectsDatabase/commonMain")
            dependencies {
                implementation(libs.kotlinxSerializationJson)
                implementation(libs.kotlinxCoroutinesCore)
                implementation(libs.kotlinxDatetime)
                implementation(libs.benasherUuid)
                implementation(libs.sqldelightRuntime)
                implementation(libs.sqldelightCoroutines)
                // ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –¥–æ–¥–∞—î–º–æ runtime-kmp
                implementation("me.tatarka.inject:kotlin-inject-runtime-kmp:0.8.0")
            }
        }

        val androidMain by getting {
            dependencies {
                implementation(libs.sqldelightAndroidDriver)
            }
        }

        val jvmMain by getting {
            dependencies {
                implementation(libs.sqldelightSqliteDriver)
            }
        }

        val commonTest by getting {
            dependencies {
                implementation(kotlin("test"))
                implementation(libs.kotlinxCoroutinesTest)
            }
        }

        val androidUnitTest by getting {
            kotlin.srcDir("src/androidUnitTest/kotlin")
            dependencies {
                implementation(libs.sqldelightAndroidDriver)
                implementation("androidx.test:core:1.5.0")
                implementation("app.cash.sqldelight:sqlite-driver:2.0.2")
            }
        }
        
        val jvmTest by getting {
            dependsOn(commonTest)
            dependencies {
                implementation("app.cash.sqldelight:sqlite-driver:2.0.2")
            }
        }
    }
}

android {
    namespace = "com.romankozak.forwardappmobile.shared"
    compileSdk = 34
    defaultConfig {
        minSdk = 29
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }
}



// ‚úÖ SQLDelight configuration
sqldelight {
    databases {
        create("ForwardAppDatabase") {
            packageName.set("com.romankozak.forwardappmobile.shared.core.data.database")
            srcDirs("src/commonMain/sqldelight")
            deriveSchemaFromMigrations.set(false)
            schemaOutputDirectory.set(file("build/generated/sqldelight/schemas/ForwardAppDatabase"))
            dialect("app.cash.sqldelight:sqlite-3-24-dialect:2.0.2")
        }
    }
}

// ‚úÖ Kotlin Inject via KSP –¥–ª—è multiplatform
dependencies {
    // –î–ª—è metadata compilation (commonMain)
    add("kspCommonMainMetadata", "me.tatarka.inject:kotlin-inject-compiler-ksp:0.8.0")
    // –î–ª—è Android
    add("kspAndroid", "me.tatarka.inject:kotlin-inject-compiler-ksp:0.8.0")
    add("kspAndroidTest", "me.tatarka.inject:kotlin-inject-compiler-ksp:0.8.0")
    // –î–ª—è JVM
    add("kspJvm", "me.tatarka.inject:kotlin-inject-compiler-ksp:0.8.0")
    add("kspJvmTest", "me.tatarka.inject:kotlin-inject-compiler-ksp:0.8.0")
}

// ‚úÖ KSP –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
ksp {
    arg("me.tatarka.inject.generateCompanionExtensions", "true")
}

// ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –±–µ–∑ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –º—ñ–∂ Debug/Release
tasks.configureEach {
    // KSP tasks –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö targets –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ metadata
    if (name == "kspKotlinJvm") {
        dependsOn("kspCommonMainKotlinMetadata")
    }
    if (name == "kspDebugKotlinAndroid") {
        dependsOn("kspCommonMainKotlinMetadata")
    }
    if (name == "kspReleaseKotlinAndroid") {
        dependsOn("kspCommonMainKotlinMetadata")
    }
}

tasks.withType<Test> {
    testLogging {
        events("passed", "skipped", "failed")
        showStandardStreams = true
    }
}
```



## shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/core/data/database/Database.kt
```kotlin
package com.romankozak.forwardappmobile.shared.core.data.database

import app.cash.sqldelight.ColumnAdapter
import app.cash.sqldelight.db.SqlDriver
import com.romankozak.forwardappmobile.shared.data.models.ProjectType
import com.romankozak.forwardappmobile.shared.data.models.ReservedGroup
import kotlinx.serialization.json.Json
import com.romankozak.forwardappmobile.shared.core.data.database.Goals
import com.romankozak.forwardappmobile.shared.core.data.database.ListItems

// ------------------------------------------------------
// üîπ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è JSON
// ------------------------------------------------------

private val json = Json {
    ignoreUnknownKeys = true
    encodeDefaults = true
}

// ------------------------------------------------------
// üîπ –ë–∞–∑–æ–≤—ñ –∞–¥–∞–ø—Ç–µ—Ä–∏ —Ç–∏–ø—ñ–≤
// ------------------------------------------------------

val longAdapter = object : ColumnAdapter<Long, Long> {
    override fun decode(databaseValue: Long) = databaseValue
    override fun encode(value: Long) = value
}

val doubleAdapter = object : ColumnAdapter<Double, Double> {
    override fun decode(databaseValue: Double) = databaseValue
    override fun encode(value: Double) = value
}

val intAdapter = object : ColumnAdapter<Int, Long> {
    override fun decode(databaseValue: Long) = databaseValue.toInt()
    override fun encode(value: Int) = value.toLong()
}

val booleanAdapter = object : ColumnAdapter<Boolean, Long> {
    override fun decode(databaseValue: Long) = databaseValue != 0L
    override fun encode(value: Boolean) = if (value) 1L else 0L
}

val stringAdapter = object : ColumnAdapter<String, String> {
    override fun decode(databaseValue: String) = databaseValue
    override fun encode(value: String) = value
}

// ------------------------------------------------------
// üîπ –§–∞–±—Ä–∏–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
// ------------------------------------------------------

fun createForwardAppDatabase(driver: SqlDriver): ForwardAppDatabase {
    val goalsAdapter = Goals.Adapter(
        createdAtAdapter = longAdapter,
        tagsAdapter = com.romankozak.forwardappmobile.shared.features.projects.data.db.ProjectsAdapters.stringListAdapter,
        relatedLinksAdapter = com.romankozak.forwardappmobile.shared.features.projects.data.db.ProjectsAdapters.relatedLinksListAdapter,
        valueImportanceAdapter = doubleAdapter,
        valueImpactAdapter = doubleAdapter,
        effortAdapter = doubleAdapter,
        costAdapter = doubleAdapter,
        riskAdapter = doubleAdapter,
        weightEffortAdapter = doubleAdapter,
        weightCostAdapter = doubleAdapter,
        weightRiskAdapter = doubleAdapter,
        rawScoreAdapter = doubleAdapter,
        displayScoreAdapter = longAdapter,
    )

    val listItemsAdapter = ListItems.Adapter(
        idAdapter = stringAdapter,
        projectIdAdapter = stringAdapter,
        itemOrderAdapter = longAdapter,
    )

    return ForwardAppDatabase(
        driver = driver,
        GoalsAdapter = goalsAdapter,
        ListItemsAdapter = listItemsAdapter
    )
}
```



## shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/data/database/DatabaseInitializer.kt
```kotlin
package com.romankozak.forwardappmobile.shared.data.database

import com.romankozak.forwardappmobile.shared.data.models.ProjectType
import com.romankozak.forwardappmobile.shared.data.models.ReservedGroup
import com.romankozak.forwardappmobile.shared.core.data.database.ForwardAppDatabase
import com.romankozak.forwardappmobile.shared.features.projects.data.db.Projects
import com.romankozak.forwardappmobile.shared.features.projects.data.db.ProjectsDatabase // Import ProjectsDatabase
import kotlinx.datetime.Clock

private data class SpecialProject(
    val id: String,
    val name: String,
    val description: String?,
    val parentId: String?,
    val projectType: ProjectType,
    val reservedGroup: ReservedGroup?,
    val order: Long
)

class DatabaseInitializer(
    private val projectsDatabase: ProjectsDatabase // Changed to ProjectsDatabase
) {

    private val specialProjects by lazy {
        listOf(
            SpecialProject("special-project-id", "special", null, null, ProjectType.SYSTEM, null, 0),
            SpecialProject("inbox-project-id", "inbox", "Default inbox for new items", "special-project-id", ProjectType.RESERVED, ReservedGroup.Inbox, 0),
            SpecialProject("strategic-group-id", "strategic", null, "special-project-id", ProjectType.RESERVED, ReservedGroup.StrategicGroup, 1),
            SpecialProject("main-beacon-realization-id", "main-beacon-realization", null, "special-project-id", ProjectType.RESERVED, ReservedGroup.MainBeaconsGroup, 2),
            SpecialProject("main-beacon-list-id", "list", null, "main-beacon-realization-id", ProjectType.RESERVED, null, 0),
            SpecialProject("mission-project-id", "mission", "Mission project", "main-beacon-list-id", ProjectType.RESERVED, ReservedGroup.MainBeacons, 0)
        )
    }

    suspend fun initialize() {
        val idMap = mutableMapOf<String, String>()

        projectsDatabase.projectsQueries.transaction { // Changed to projectsDatabase.projectsQueries
            specialProjects.forEach { projectInfo ->
                val existingProject = findExistingProject(projectInfo)
                val parentIdFromMap = projectInfo.parentId?.let { idMap[it] }

                if (existingProject == null) {
                    val newId = insertProject(projectInfo, parentIdFromMap)
                    idMap[projectInfo.id] = newId
                } else {
                    idMap[projectInfo.id] = existingProject.id
                    if (existingProject.parentId != parentIdFromMap) {
                        projectsDatabase.projectsQueries.updateParent(parentIdFromMap, existingProject.id) // Changed
                    }
                }
            }
        }
    }

    private fun findExistingProject(projectInfo: SpecialProject): Projects? {
        // Find by SYSTEM type for the root special project
        if (projectInfo.projectType == ProjectType.SYSTEM) {
            return projectsDatabase.projectsQueries.getProjectsByType(ProjectType.SYSTEM).executeAsOneOrNull() // Changed
        }
        // Find by reserved group if it exists
        if (projectInfo.reservedGroup != null) {
            return projectsDatabase.projectsQueries.getProjectsByReservedGroup(projectInfo.reservedGroup).executeAsOneOrNull() // Changed
        }
        // Fallback to ID
        return projectsDatabase.projectsQueries.getProjectById(projectInfo.id).executeAsOneOrNull() // Changed
    }

    private fun insertProject(projectInfo: SpecialProject, parentId: String?): String {
        val newId = if (projectInfo.projectType == ProjectType.SYSTEM || projectInfo.reservedGroup != null) {
            projectInfo.id
        } else {
            // For projects that are not uniquely identifiable, we might need a new ID
            // but for this list, we assume IDs are stable.
            projectInfo.id
        }

        projectsDatabase.projectsQueries.insertProject( // Changed
            id = newId,
            name = projectInfo.name,
            description = projectInfo.description,
            parentId = parentId,
            createdAt = Clock.System.now().toEpochMilliseconds(),
            updatedAt = null,
            tags = emptyList(),
            relatedLinks = emptyList(),
            isExpanded = false,
            goalOrder = projectInfo.order,
            isAttachmentsExpanded = false,
            defaultViewMode = null,
            isCompleted = false,
            isProjectManagementEnabled = false,
            projectStatus = null,
            projectStatusText = null,
            projectLogLevel = null,
            totalTimeSpentMinutes = 0,
            valueImportance = 0.0,
            valueImpact = 0.0,
            effort = 0.0,
            cost = 0.0,
            risk = 0.0,
            weightEffort = 1.0,
            weightCost = 1.0,
            weightRisk = 1.0,
            rawScore = 0.0,
            displayScore = 0,
            scoringStatus = "NOT_ASSESSED",
            showCheckboxes = false,
            projectType = projectInfo.projectType,
            reservedGroup = projectInfo.reservedGroup
        )
        return newId
    }
}
```



## shared/src/commonMain/sqldelight/com/romankozak/forwardappmobile/shared/core/data/database/Goals.sq
```sql


import kotlin.Boolean;
import com.romankozak.forwardappmobile.shared.data.database.models.RelatedLinkList;
import com.romankozak.forwardappmobile.shared.data.database.models.StringList;
import kotlin.Long;
import kotlin.Double;
import kotlin.Int;
import kotlin.String;

CREATE TABLE Goals (
    id TEXT NOT NULL PRIMARY KEY,
    text TEXT NOT NULL,
    description TEXT,
    completed INTEGER AS Boolean NOT NULL DEFAULT 0,
    createdAt INTEGER AS Long NOT NULL,
    updatedAt INTEGER AS Long,
    tags TEXT AS StringList,
    relatedLinks TEXT AS RelatedLinkList,
    valueImportance REAL AS Double NOT NULL DEFAULT 0.0,
    valueImpact REAL AS Double NOT NULL DEFAULT 0.0,
    effort REAL AS Double NOT NULL DEFAULT 0.0,
    cost REAL AS Double NOT NULL DEFAULT 0.0,
    risk REAL AS Double NOT NULL DEFAULT 0.0,
    weightEffort REAL AS Double NOT NULL DEFAULT 1.0,
    weightCost REAL AS Double NOT NULL DEFAULT 1.0,
    weightRisk REAL AS Double NOT NULL DEFAULT 1.0,
    rawScore REAL AS Double NOT NULL DEFAULT 0.0,
    displayScore INTEGER AS Long NOT NULL DEFAULT 0,
    scoringStatus TEXT NOT NULL,
    parentValueImportance REAL AS Double,
    impactOnParentGoal REAL AS Double,
    timeCost REAL AS Double,
    financialCost REAL AS Double,
    markdown TEXT
);

insertGoal:
INSERT OR REPLACE INTO Goals (
    id, text, description, completed, createdAt, updatedAt, tags, relatedLinks,
    valueImportance, valueImpact, effort, cost, risk, weightEffort, weightCost,
    weightRisk, rawScore, displayScore, scoringStatus, parentValueImportance,
    impactOnParentGoal, timeCost, financialCost, markdown
) VALUES (
    :id, :text, :description, :completed, :createdAt, :updatedAt, :tags, :relatedLinks,
    :valueImportance, :valueImpact, :effort, :cost, :risk, :weightEffort, :weightCost,
    :weightRisk, :rawScore, :displayScore, :scoringStatus, :parentValueImportance,
    :impactOnParentGoal, :timeCost, :financialCost, :markdown
);

updateGoal:
UPDATE Goals SET
    text = :text,
    description = :description,
    completed = :completed,
    updatedAt = :updatedAt,
    tags = :tags,
    relatedLinks = :relatedLinks,
    valueImportance = :valueImportance,
    valueImpact = :valueImpact,
    effort = :effort,
    cost = :cost,
    risk = :risk,
    weightEffort = :weightEffort,
    weightCost = :weightCost,
    weightRisk = :weightRisk,
    rawScore = :rawScore,
    displayScore = :displayScore,
    scoringStatus = :scoringStatus,
    parentValueImportance = :parentValueImportance,
    impactOnParentGoal = :impactOnParentGoal,
    timeCost = :timeCost,
    financialCost = :financialCost,
    markdown = :markdown
WHERE id = :id;

deleteGoal:
DELETE FROM Goals WHERE id = :id;

deleteAll:
DELETE FROM Goals;

getGoalById:
SELECT * FROM Goals WHERE id = :id;

getAllGoals:
SELECT * FROM Goals ORDER BY createdAt DESC;

getGoalsByIds:
SELECT * FROM Goals WHERE id IN :ids;

searchGoalsByText:
SELECT * FROM Goals WHERE text LIKE '%' || :query || '%' OR description LIKE '%' || :query || '%';

getAllGoalsCount:
SELECT count(*) FROM Goals;

updateMarkdown:
UPDATE Goals SET markdown = :markdown WHERE id = :goalId;
```



## shared/src/commonMain/sqldelight/com/romankozak/forwardappmobile/shared/core/data/database/ListItems.sq
```sql


import kotlin.Long;
import kotlin.String;

CREATE TABLE ListItems (
    id TEXT AS kotlin.String NOT NULL PRIMARY KEY,
    projectId TEXT AS kotlin.String NOT NULL,
    itemOrder INTEGER AS kotlin.Long NOT NULL DEFAULT 0,
    entityId TEXT AS kotlin.String,
    itemType TEXT AS kotlin.String
);

getItemsForProject:
SELECT * FROM ListItems WHERE projectId = :projectId ORDER BY itemOrder ASC, id ASC;

insertItem:
INSERT OR REPLACE INTO ListItems(id, projectId, itemOrder, entityId, itemType)
VALUES (:id, :projectId, :itemOrder, :entityId, :itemType);

updateItem:
UPDATE ListItems SET
    projectId = :projectId,
    itemOrder = :itemOrder,
    entityId = :entityId,
    itemType = :itemType
WHERE id = :id;

deleteItemsByIds:
DELETE FROM ListItems WHERE id IN :itemIds;

deleteItemsForProjects:
DELETE FROM ListItems WHERE projectId IN :projectIds;

getAll:
SELECT * FROM ListItems;

getLinkCount:
SELECT COUNT(*) FROM ListItems WHERE entityId = :entityId AND projectId = :projectId;

deleteLinkByEntityAndProject:
DELETE FROM ListItems WHERE entityId = :entityId AND projectId = :projectId;

updateListItemProjectIds:
UPDATE ListItems SET projectId = :targetProjectId WHERE id IN :itemIds;

getItemsForProjectSyncForDebug:
SELECT * FROM ListItems WHERE projectId = :projectId ORDER BY itemOrder ASC, id ASC;

deleteAll:
DELETE FROM ListItems;

getGoalIdsForProject:
SELECT entityId FROM ListItems WHERE projectId = :projectId AND itemType = 'GOAL';

deleteItemByEntityId:
DELETE FROM ListItems WHERE entityId = :entityId;

getListItemByEntityId:
SELECT * FROM ListItems WHERE entityId = :entityId LIMIT 1;

findProjectIdForGoal:
SELECT projectId FROM ListItems WHERE entityId = :goalId LIMIT 1;

insertListItem:
INSERT OR REPLACE INTO ListItems (
    id,
    projectId,
    itemOrder,
    entityId,
    itemType
) VALUES (
    :id,
    :projectId,
    :itemOrder,
    :entityId,
    :itemType
);
```



## shared/src/commonMain/sqldelight/features/projects/com/romankozak/forwardappmobile/shared/features/projects/data/db/Projects.sq
```sql
-- database: ForwardAppDatabase


import com.romankozak.forwardappmobile.shared.data.database.models.StringList;
import com.romankozak.forwardappmobile.shared.data.database.models.RelatedLinkList;
import com.romankozak.forwardappmobile.shared.data.models.ProjectType;
import com.romankozak.forwardappmobile.shared.data.models.ReservedGroup;
import kotlin.Boolean;
import kotlin.Double;
import kotlin.Int;
import kotlin.Long;
import kotlin.String;

CREATE TABLE Projects (
    id TEXT NOT NULL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    parentId TEXT,
    createdAt INTEGER AS Long NOT NULL,
    updatedAt INTEGER AS Long,
    tags TEXT AS StringList,
    relatedLinks TEXT AS RelatedLinkList,
    isExpanded INTEGER AS Boolean NOT NULL DEFAULT 1,
    goalOrder INTEGER AS Long NOT NULL DEFAULT 0,
    isAttachmentsExpanded INTEGER AS Boolean NOT NULL DEFAULT 0,
    defaultViewMode TEXT,
    isCompleted INTEGER AS Boolean NOT NULL DEFAULT 0,
    isProjectManagementEnabled INTEGER AS Boolean DEFAULT 0,
    projectStatus TEXT,
    projectStatusText TEXT,
    projectLogLevel TEXT DEFAULT 'NORMAL',
    totalTimeSpentMinutes INTEGER AS Long DEFAULT 0,
    valueImportance REAL AS Double NOT NULL DEFAULT 0.0,
    valueImpact REAL AS Double NOT NULL DEFAULT 0.0,
    effort REAL AS Double NOT NULL DEFAULT 0.0,
    cost REAL AS Double NOT NULL DEFAULT 0.0,
    risk REAL AS Double NOT NULL DEFAULT 0.0,
    weightEffort REAL AS Double NOT NULL DEFAULT 1.0,
    weightCost REAL AS Double NOT NULL DEFAULT 1.0,
    weightRisk REAL AS Double NOT NULL DEFAULT 1.0,
    rawScore REAL AS Double NOT NULL DEFAULT 0.0,
    displayScore INTEGER AS Long NOT NULL DEFAULT 0,
    scoringStatus TEXT NOT NULL DEFAULT 'NOT_ASSESSED',
    showCheckboxes INTEGER AS Boolean NOT NULL DEFAULT 0,
    projectType TEXT AS ProjectType NOT NULL DEFAULT 'DEFAULT',
    reservedGroup TEXT AS ReservedGroup
);

getAllProjects:
SELECT * FROM Projects ORDER BY goalOrder ASC;

getProjectById:
SELECT * FROM Projects WHERE id = :id;

insertProject:
INSERT OR REPLACE INTO Projects (
    id, name, description, parentId, createdAt, updatedAt, tags, relatedLinks,
    isExpanded, goalOrder, isAttachmentsExpanded, defaultViewMode, isCompleted,
    isProjectManagementEnabled, projectStatus, projectStatusText, projectLogLevel,
    totalTimeSpentMinutes, valueImportance, valueImpact, effort, cost, risk,
    weightEffort, weightCost, weightRisk, rawScore, displayScore, scoringStatus,
    showCheckboxes, projectType, reservedGroup
) VALUES (
    :id, :name, :description, :parentId, :createdAt, :updatedAt, :tags, :relatedLinks,
    :isExpanded, :goalOrder, :isAttachmentsExpanded, :defaultViewMode, :isCompleted,
    :isProjectManagementEnabled, :projectStatus, :projectStatusText, :projectLogLevel,
    :totalTimeSpentMinutes, :valueImportance, :valueImpact, :effort, :cost, :risk,
    :weightEffort, :weightCost, :weightRisk, :rawScore, :displayScore, :scoringStatus,
    :showCheckboxes, :projectType, :reservedGroup
);

deleteProject:
DELETE FROM Projects WHERE id = :id;

getProjectsByType:
SELECT * FROM Projects WHERE projectType = :projectType;

deleteProjectsForReset:
DELETE FROM Projects;

getProjectsByReservedGroup:
SELECT * FROM Projects
WHERE reservedGroup = :reservedGroup;

getAllProjectsUnordered:
SELECT * FROM Projects;

updateParent:
UPDATE Projects SET parentId = :parentId WHERE id = :id;

updateName:
UPDATE Projects SET name = :name WHERE id = :id;
```



## shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/features/projects/data/mappers/ProjectMapper.kt
```kotlin
package com.romankozak.forwardappmobile.shared.features.projects.data.mappers

import com.romankozak.forwardappmobile.shared.features.projects.data.db.Projects
import com.romankozak.forwardappmobile.shared.features.projects.data.models.Project
import com.romankozak.forwardappmobile.shared.core.data.database.booleanAdapter
import com.romankozak.forwardappmobile.shared.features.projects.data.db.ProjectsAdapters.stringListAdapter
import com.romankozak.forwardappmobile.shared.features.projects.data.db.ProjectsAdapters.relatedLinksListAdapter
import com.romankozak.forwardappmobile.shared.data.models.ProjectType
import com.romankozak.forwardappmobile.shared.data.models.ReservedGroup
import com.romankozak.forwardappmobile.shared.data.models.ScoringStatusValues

fun Projects.toDomain(): Project {
    return Project(
        id = id,
        name = name,
        description = description,
        parentId = parentId,
        createdAt = createdAt,
        updatedAt = updatedAt,
        tags = tags,
        relatedLinks = relatedLinks,
        isExpanded = isExpanded,
        goalOrder = goalOrder,
        isAttachmentsExpanded = isAttachmentsExpanded,
        defaultViewMode = defaultViewMode,
        isCompleted = isCompleted,
        isProjectManagementEnabled = isProjectManagementEnabled,
        projectStatus = projectStatus,
        projectStatusText = projectStatusText,
        projectLogLevel = projectLogLevel,
        totalTimeSpentMinutes = totalTimeSpentMinutes,
        valueImportance = valueImportance,
        valueImpact = valueImpact,
        effort = effort,
        cost = cost,
        risk = risk,
        weightEffort = weightEffort,
        weightCost = weightCost,
        weightRisk = weightRisk,
        rawScore = rawScore,
        displayScore = displayScore,
        scoringStatus = scoringStatus ?: ScoringStatusValues.NOT_ASSESSED,
        showCheckboxes = showCheckboxes,
        projectType = projectType,
        reservedGroup = reservedGroup
    )
}
```



## shared/src/commonMain/kotlin/com/romankozak/forwardappmobile/shared/features/projects/data/repository/ProjectRepositoryImpl.kt
```kotlin
package com.romankozak.forwardappmobile.shared.features.projects.data.repository

import app.cash.sqldelight.coroutines.asFlow
import app.cash.sqldelight.coroutines.mapToList
import app.cash.sqldelight.coroutines.mapToOneOrNull
import com.romankozak.forwardappmobile.shared.features.projects.data.db.ProjectsDatabase // Import ProjectsDatabase
import com.romankozak.forwardappmobile.shared.features.projects.data.mappers.toDomain
import com.romankozak.forwardappmobile.shared.features.projects.data.models.Project
import kotlinx.coroutines.CoroutineDispatcher
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.map

class ProjectRepositoryImpl(
    private val projectsDatabase: ProjectsDatabase, // Changed to ProjectsDatabase
    private val dispatcher: CoroutineDispatcher
) : ProjectRepository {

    override fun getAllProjects(): Flow<List<Project>> {
        return projectsDatabase.projectsQueries.getAllProjects() // Changed
            .asFlow()
            .mapToList(dispatcher)
            .map { projects -> projects.map { it.toDomain() } }
    }

    override fun getProjectById(id: String): Flow<Project?> {
        return projectsDatabase.projectsQueries.getProjectById(id) // Changed
            .asFlow()
            .mapToOneOrNull(dispatcher)
            .map { it?.toDomain() }
    }
}
```

