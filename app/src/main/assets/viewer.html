<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Viewer</title>
    <style>
        /* Light theme (default) */
        body {
            margin: 16px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.5;
            font-size: 0.9em;
            word-wrap: break-word;
            color: #000000;
            background-color: transparent;
        }
        p {
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }
        h1 { font-size: 1.3em; }
        h2 { font-size: 1.2em; }
        h3 { font-size: 1.1em; }
        h4, h5, h6 { font-size: 1.0em; }
        th {
            background-color: #f2f2f2;
        }
        pre {
            background-color: #eee;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            white-space: nowrap;
        }
        .mermaid {
            background: #f9f9f9;
        }

        /* Dark theme */
        body.dark {
            color: #FFFFFF;
            background-color: transparent;
        }
        body.dark th {
            background-color: #222222;
        }
        body.dark pre {
            background-color: #333333;
        }
        body.dark th, body.dark td {
            border: 1px solid #444444;
        }
        body.dark .mermaid {
            background: #202020;
        }

        /* Common styles */
        table {
            display: block;
            width: 100%;
            overflow-x: auto;
            border-collapse: collapse;
            margin-top: 1em;
            margin-bottom: 1em;
            -webkit-overflow-scrolling: touch;
        }
        pre {
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        code {
            font-family: monospace;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            padding: 10px;
            border-radius: 8px;
            margin-top: 1em;
            margin-bottom: 1em;
        }
    </style>
    <script type="module">
        async function initialize() {
            const MarkdownIt = (await import("https://esm.sh/markdown-it")).default;
            const mermaid = (await import("https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs")).default;

            const md = new MarkdownIt({ html: true });

            const defaultFence = md.renderer.rules.fence;
            md.renderer.rules.fence = (tokens, idx, options, env, self) => {
                const token = tokens[idx];
                if (token.info.trim() === 'mermaid') {
                    return `<div class="mermaid">${token.content}</div>`;
                }
                return defaultFence(tokens, idx, options, env, self);
            };

            mermaid.initialize({ startOnLoad: false });

            window.renderMarkdown = (markdownText) => {
                const contentDiv = document.getElementById('content');
                if (contentDiv) {
                    contentDiv.innerHTML = md.render(markdownText || "");
                    mermaid.run({ nodes: contentDiv.querySelectorAll('.mermaid') });
                }
            };

            if (window.AndroidBridge && window.AndroidBridge.onJsReady) {
                window.AndroidBridge.onJsReady();
            }
        }

        initialize();
    </script>
</head>
<body>
<div id="content"></div>
</body>
</html>