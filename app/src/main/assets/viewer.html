<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Viewer</title>
    <style>
        /* ✨ ЗАГАЛЬНІ ПОКРАЩЕННЯ ДЛЯ ЧИТАБЕЛЬНОСТІ */
        body {
            margin: 16px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6; /* Збільшений міжрядковий інтервал */
            font-size: 1.1em;   /* Трохи більший базовий шрифт */
            word-wrap: break-word;
        }

        /* ✨ АДАПТИВНІ ТАБЛИЦІ */
        table {
            display: block; /* Дозволяє таблиці мати власну прокрутку */
            width: 100%;
            overflow-x: auto; /* Додає горизонтальну прокрутку тільки якщо таблиця ширша за екран */
            border-collapse: collapse;
            margin-top: 1em;
            margin-bottom: 1em;
            -webkit-overflow-scrolling: touch; /* Плавна прокрутка на iOS */
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            white-space: nowrap; /* Забороняємо перенесення тексту в клітинках, щоб зберегти форматування */
        }
        th {
            background-color: #f2f2f2;
        }

        /* ✨ АДАПТИВНІ БЛОКИ КОДУ */
        pre {
            background-color: #eee;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap; /* Дозволяє переносити довгі рядки коду */
            word-break: break-all;
        }
        code {
            font-family: monospace;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            margin-top: 1em;
            margin-bottom: 1em;
        }
    </style>
    <script type="module">
        async function initialize() {
            const MarkdownIt = (await import("https://esm.sh/markdown-it")).default;
            const mermaid = (await import("https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs")).default;

            const md = new MarkdownIt({ html: true });

            const defaultFence = md.renderer.rules.fence;
            md.renderer.rules.fence = (tokens, idx, options, env, self) => {
                const token = tokens[idx];
                if (token.info.trim() === 'mermaid') {
                    return `<div class="mermaid">${token.content}</div>`;
                }
                return defaultFence(tokens, idx, options, env, self);
            };

            mermaid.initialize({ startOnLoad: false });

            window.renderMarkdown = (markdownText) => {
                const contentDiv = document.getElementById('content');
                if (contentDiv) {
                    contentDiv.innerHTML = md.render(markdownText || "");
                    mermaid.run({ nodes: contentDiv.querySelectorAll('.mermaid') });
                }
            };

            if (window.AndroidBridge && window.AndroidBridge.onJsReady) {
                window.AndroidBridge.onJsReady();
            }
        }

        initialize();
    </script>
</head>
<body>
<div id="content"></div>
</body>
</html>